<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: plugins/contextmenu/contextmenu.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: plugins/contextmenu/contextmenu.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ContextMenu plugin script
 *
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this file.
 *
 * Copyright (C) Philip Weir
 *
 * The JavaScript code in this page is free software: you can redistribute it
 * and/or modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation, either version 3 of
 * the License, or (at your option) any later version.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in this file.
 */

rcube_webmail.prototype.contextmenu = {
    settings: {
        no_right_click_on_menu: true,
        skip_commands: ['mail-checkmail', 'mail-compose', 'addressbook-add', 'addressbook-import', 'addressbook-advanced-search', 'addressbook-search-create'],
        command_pattern: /rcmail\.command\(\x27([^\x27]+)\x27,\s?\x27((?:\\\x27|[^\x27])*)\x27/,
        addressbook_pattern: /([A-Z0-9\-_]+(:[A-Z0-9\-_]+)?)/i,
        popup_attrib: 'onclick',
        popup_pattern: '',
        popup_func: '',
        classes: {
                container: 'contextmenu popupmenu',
                mainmenu: 'rcmmainmenu rcm-mainmenu', // rcmmainmenu class depreciated in v3.0
                submenu: 'rcmsubmenu submenu rcm-submenu', // rcmsubmenu submenu classes depreciated in v3.0
                button_remove: 'button',
                button_active: 'active',
                button_disabled: 'disabled'
            },
        menu_defaults: {},
        global_events: {
            'submenu_toggle': function(p) {
                $(p.id).parent()[(p.show) ? 'show' : 'hide']();
            }
        },
        menu_events: {
            'command': function(p) {
                if (!$(p.el).is('.' + rcmail.contextmenu.settings.classes.button_active.replace(/ /g, ', .')))
                    return;

                var result = rcmail.command(p.command, p.args, p.el, p.evt, true);

                return result;
            }
        }
    },

    vars: {
        popup_menus: [],
        popup_commands: {},
    },

    skin_funcs: {},

    init_list: function(row, props, events) {
        if (!events)
            events = {};

        // backwards compatibility, list_object changed to string in v3.0
        if (typeof props.list_object == 'object') {
            console.log('Roundcube ContextMenu plugin: init_list() list_object param object detected, expected string.');
            var id = $(props.list_object.list).attr('id');
            props.list_object = null;

            if (id == 'contacts-table') {
                props.list_object = 'contact_list';
            }
        }

        if (!props.list_object)
            props.list_object = 'message_list';

        var trigger_list_select = function(list) {
            var prev_contentframe = rcmail.env.contentframe;
            rcmail.env.contentframe = null;
            rcmail[list].triggerEvent('select');
            rcmail.env.contentframe = prev_contentframe;
        };

        var menu = rcmail.contextmenu.init(props, $.extend({
            'beforeactivate': function(p) {
                if (p.ref.is_submenu) {
                    p.ref.menu_selection = p.ref.parent_menu.menu_selection;
                }
                else if (rcmail[p.ref.list_object].selection.length == 0 || !rcmail[p.ref.list_object].in_selection(rcmail.env.context_menu_source_id)) {
                    p.ref.menu_selection = [rcmail.env.context_menu_source_id];
                }
                else {
                    p.ref.menu_selection = rcmail[p.ref.list_object].get_selection();
                }

                if (!rcmail[p.ref.list_object].in_selection(rcmail.env.context_menu_source_id)) {
                    rcmail.env.contextmenu_opening = 'beforeactivate';
                    trigger_list_select(p.ref.list_object);
                }

                if (rcmail.task == 'settings' &amp;&amp; p.ref.menu_name != 'settingslist') {
                    p.ref.container.find('a.openextwin').parent().remove();
                }
            },
            'afteractivate': function(p) {
                rcmail.env.contextmenu_opening = 'afteractivate';
                if (!rcmail[p.ref.list_object].in_selection(rcmail.env.context_menu_source_id))
                    trigger_list_select(p.ref.list_object);

                rcmail.env.contextmenu_opening = null;
            },
            'beforecommand': function(p) {
                if (rcmail.task == 'settings' &amp;&amp; p.ref.menu_name != 'settingslist' &amp;&amp; p.command == 'plugin.contextmenu.openinline') {
                    rcmail[p.ref.list_object].select_row(rcmail.env.context_menu_source_id);
                    return {'abort': true, 'result': true};
                }
            },
            'aftercommand': function(p) {
                if (p.command == 'group-remove-selected') {
                    // update contactlist after contact remove (not done by core because there is no selection)
                    rcmail.command('listgroup', {'source': rcmail.env.source, 'id': rcmail.env.group}, p.el);
                }
            }
        }, events));

        $("#" + row).on('contextmenu', function(e) {
            var uid;
            if (uid = rcmail[props.list_object].get_row_uid(this)) {
                rcmail.contextmenu.hide_all(e);
                rcmail.contextmenu.show_one(e, this, uid, menu);
            }
        });

        rcmail[props.list_object].addEventListener('getselection', function(p) {
            if (rcmail.env.contextmenu_opening == 'afteractivate')
                return;

            var uids = null;
            $.each(rcmail.env.contextmenus, function() {
                if (this.menu_selection.length > 0 &amp;&amp; (rcmail.env.contextmenu_opening == 'beforeactivate' || $(this.container).is(':visible'))) {
                    uids = this.menu_selection;
                    return false;
                }
            });

            if (uids) {
                p.res = uids;
                return false;
            }
        });
    },

    init_folder: function(el, props, events) {
        if (!events)
            events = {};

        var menu = rcmail.contextmenu.init($.extend({'menu_name': 'folderlist', 'list_object': null}, props), $.extend({
            'beforeactivate': function() {
                if (rcmail.env.contextmenu_messagecount_request) {
                    rcmail.env.contextmenu_messagecount_request.abort();
                }
                rcmail.env.contextmenu_messagecount_request = null;
            },
            'activate': function(p) {
                return rcmail.contextmenu.activate_folder_commands(p);
            },
            'beforecommand': function(p) {
                if (rcmail.env.context_menu_source_id != rcmail.env.mailbox &amp;&amp; $.inArray(p.command, Array('expunge', 'purge')) >= 0) {
                    rcmail[p.command + '_mailbox'](rcmail.env.context_menu_source_id);
                    return {'abort': true, 'result': true};
                }
                else if (rcmail.env.context_menu_source_id != rcmail.env.mailbox &amp;&amp; p.command == 'mark-all-read') {
                    rcmail.mark_all_read(rcmail.env.context_menu_source_id);
                    return {'abort': true, 'result': true};
                }
            }
        }, events));

        $(el).on('click', function(e) {
            // hide menu when changing folder
            rcmail.contextmenu.hide_all(e);
        })
        .on('contextmenu', function(e) {
            var source = $(this).find('a[rel][onclick]').filter(function() { return $(this).attr('onclick').match(rcmail.contextmenu.settings.command_pattern); }).first();
            source.blur(); // remove focus (and keyboard nav highlighting) from source element

            rcmail.contextmenu.hide_all(e);
            rcmail.contextmenu.show_one(e, this, source.attr('rel'), menu);
        });
    },

    init_addressbook: function(el, props, events) {
        if (!events)
            events = {};

        var menu = rcmail.contextmenu.init($.extend({'menu_name': 'abooklist'}, props), $.extend({
            'beforeactivate': function(p) {
                p.ref.container.find('li.' + rcmail.contextmenu.settings.classes.submenu.replace(/ /g, '.')).remove();
            },
            'activate': function(p) {
                var ids = rcmail.env.context_menu_source_id.split(':', 2);
                var cur_source = ids[0];

                if (p.command == 'group-create') {
                    // addressbook
                    if ($(p.source).hasClass('addressbook') &amp;&amp; rcmail.env.address_sources[cur_source].groups &amp;&amp; !rcmail.env.address_sources[cur_source].readonly) {
                        p.enabled = true;
                    }
                    else {
                        p.enabled = false;
                    }
                }
                else if (p.command == 'group-rename' || p.command == 'group-delete') {
                    // group
                    if ($(p.source).hasClass('contactgroup') &amp;&amp; !rcmail.env.address_sources[cur_source].readonly) {
                        p.enabled = true;
                    }
                    else {
                        p.enabled = false;
                    }
                }
                else if (p.command == 'search-delete') {
                    // saved search
                    if ($(p.source).hasClass('contactsearch')) {
                        p.enabled = true;
                    }
                    else {
                        p.enabled = false;
                    }
                }

                return p;
            },
            'command': function(p) {
                if (!$(p.el).is('.' + rcmail.contextmenu.settings.classes.button_active.replace(/ /g, ', .')))
                    return;

                var prev_source = rcmail.env.source;
                var prev_group = rcmail.env.group;
                var result = false;

                var ids = rcmail.env.context_menu_source_id.split(':', 2);
                var cur_source = ids[0];
                var cur_id = ids[1];

                rcmail.env.source = cur_source;
                rcmail.env.group = cur_id;

                switch (p.command) {
                    case 'search-delete':
                        if ($(p.ref.selected_object).children('a').attr('rel')) {
                            var prev_search_id = rcmail.env.search_id;
                            var prev_search_request = rcmail.env.search_request;
                            rcmail.env.search_request = true;
                            rcmail.env.search_id = $(p.ref.selected_object).children('a').attr('rel').replace('S', '');

                            result = rcmail.command(p.command, p.args, p.el, p.evt, true);

                            rcmail.env.search_request = prev_search_request;
                            rcmail.env.search_id = prev_search_id;
                        }
                        break;
                    default:
                        result = rcmail.command(p.command, p.args, p.el, p.evt, true);
                        break;
                }

                rcmail.env.source = prev_source;
                rcmail.env.group = prev_group;

                return result;
            }
        }, events));

        $(el).on('click', function(e) {
            // hide menu when changing address book
            rcmail.contextmenu.hide_all(e);
        })
        .on('contextmenu', function(e) {
            var source = $(this).find('a[rel]').filter(function() { return $(this).attr('rel').match(rcmail.contextmenu.settings.addressbook_pattern); }).first(), matches;
            source.blur(); // remove focus (and keyboard nav highlighting) from source element

            if (matches = source.attr('rel').match(rcmail.contextmenu.settings.addressbook_pattern)) {
                rcmail.contextmenu.hide_all(e);
                rcmail.contextmenu.show_one(e, this, matches[1], menu);
            }
        });
    },

    init_settings: function(el, props, events) {
        if (!events)
            events = {};

        var menu = rcmail.contextmenu.init(props, $.extend({
            'beforeactivate': function(p) {
                if (p.ref.menu_name != 'settingslist') {
                    p.ref.container.find('a.openextwin').parent().remove();
                }

                if (p.ref.menu_name == 'folderlist') {
                    if (rcmail.env.contextmenu_messagecount_request) {
                        rcmail.env.contextmenu_messagecount_request.abort();
                    }
                    rcmail.env.contextmenu_messagecount_request = null;
                }
            },
            'activate': function(p) {
                if (p.ref.menu_name == 'folderlist') {
                    p = rcmail.contextmenu.activate_folder_commands(p);
                }

                return p;
            },
            'beforecommand': function(p) {
                if (p.ref.menu_name == 'folderlist') {
                    var result;
                    if ($.inArray(p.command, Array('delete-folder', 'purge')) >= 0) {
                        result = rcmail[p.command == 'delete-folder' ? 'delete_folder' : p.command + '_mailbox'](rcmail.env.context_menu_source_id);
                    }
                    else if (p.command == 'plugin.contextmenu.openinline') {
                        rcmail[p.ref.list_object].select(rcmail.env.context_menu_source_id);
                    }
                    else {
                        result = rcmail.command(p.command, p.args);
                    }

                    return {'abort': true, 'result': true};
                }
            }
        }, events));

        $(el).on('contextmenu', function(e) {
            var source = $(this).find('a').first();
            source.blur(); // remove focus (and keyboard nav highlighting) from source element

            if (props.menu_name == 'settingslist') {
                var matches;
                if (matches = source.attr('onclick').match(rcmail.contextmenu.settings.command_pattern)) {
                    rcmail.contextmenu.hide_all(e);
                    rcmail.contextmenu.show_one(e, this, matches[2], menu);
                }
            }
            else if (props.menu_name == 'folderlist') {
                rcmail.contextmenu.hide_all(e);
                rcmail.contextmenu.show_one(e, this, rcmail.folder_id2name($(this).attr('id')), menu);
            }
        });
    },

    init: function(props, ext_events) {
        var events = $.extend({}, rcmail.contextmenu.settings.menu_events, ext_events), menu;

        if (!rcmail.env.contextmenus[props.menu_name]) {
            menu = new rcube_context_menu(props);

            $.each(rcmail.contextmenu.settings.global_events, function(trigger, func) {
                menu.addEventListener(trigger, function(p) { return func(p); });
            });

            $.each(events, function(trigger, func) {
                menu.addEventListener(trigger, function(p) { return func(p); });
            });

            menu.init();
            rcmail.env.contextmenus[props.menu_name] = menu;
        }
        else {
            menu = rcmail.env.contextmenus[props.menu_name];
        }

        return menu;
    },

    show_one: function(e, src_elm, src_id, menu_obj) {
        // if contextmenus have been disabled then show browser context menu as normal
        if (!rcmail.env.contextmenu)
            return true;

        rcube_event.cancel(e);

        // hide any other open menus
        for (var i = 0; i &lt; rcmail.contextmenu.vars.popup_menus.length; i++) {
            rcmail.hide_menu(rcmail.contextmenu.vars.popup_menus[i], e);
        }

        rcmail.env.context_menu_source_id = src_id;
        menu_obj.show_menu(src_elm, e);
    },

    hide_all: function(e, sub_only, no_trigger) {
        var remove_menu = function(e, menu) {
            if (!menu.container.is(':visible'))
                return;

            menu.hide_menu(e);

            if (!no_trigger) {
                var menu_name = 'rcm_' + menu.menu_name;
                rcmail.triggerEvent('menu-close', { name: menu_name, props:{ menu: menu_name }, originalEvent: e });
            }
        }

        $.each(rcmail.env.contextmenus, function() {
            if (!sub_only) {
                remove_menu(e, this);
            }
            else {
                $.each(this.submenus, function() {
                    remove_menu(e, this);
                });
            }
        });

        // close popup menus opened by the contextmenu
        for (var i = rcmail.contextmenu.vars.popup_menus.length - 1; i >= 0; i--) {
            rcmail.hide_menu(rcmail.contextmenu.vars.popup_menus[i], e);
        }
    },

    activate_folder_commands: function(p) {
        if ($.inArray(p.command, Array('expunge', 'purge', 'mark-all-read')) >= 0) {
            // disable the commands by default
            p.enabled = false;

            // if menu is opened on current folder (or special mark-all-read command) then enable the commands same as in UI
            if ((rcmail.env.context_menu_source_id == rcmail.env.mailbox || p.command == 'mark-all-read') &amp;&amp; rcmail.commands[p.command]) {
                p.enabled = true;
            }
            // if menu is opened on difference folder then get message count for the folder
            else if (rcmail.env.context_menu_source_id != rcmail.env.mailbox &amp;&amp; !rcmail.env.contextmenu_messagecount_request) {
                p.enabled = false;

                // folder check called async to prevent slowdown on menu load
                rcmail.env.contextmenu_messagecount_request = $.ajax({
                    type: 'POST', url: rcmail.url('plugin.contextmenu.messagecount'), data: {'_mbox': rcmail.env.context_menu_source_id}, dataType: 'json', async: true,
                    success: function(data) {
                        if (data.messagecount > 0 &amp;&amp; $('#rcm_folderlist').is(':visible')) {
                            // override the environment to check if commands should be abled
                            var temp_exists = rcmail.env.exists;
                            var temp_mailbox = rcmail.env.mailbox;
                            rcmail.env.exists = data.messagecount;
                            rcmail.env.mailbox = rcmail.env.context_menu_source_id;

                            if (data.messagecount > 0) {
                                $('#rcm_folderlist').find('a.cmd_expunge').addClass(rcmail.contextmenu.settings.classes.button_active).removeClass(rcmail.contextmenu.settings.classes.button_disabled);
                                $('#rcm_folderlist').find('a.cmd_purge').addClass(rcmail.contextmenu.settings.classes.button_active).removeClass(rcmail.contextmenu.settings.classes.button_disabled);
                            }

                            rcmail.env.exists = temp_exists;
                            rcmail.env.mailbox = temp_mailbox;
                        }
                    }
                });
            }
        }
        else if ($.inArray(p.command, Array('plugin.contextmenu.collapseall', 'plugin.contextmenu.expandall')) >= 0) {
            var list_obj = rcmail.gui_objects[rcmail.env.task == 'settings' ? 'subscriptionlist' : 'mailboxlist'];
            var class_name = p.command == 'plugin.contextmenu.collapseall' ? 'expanded' : 'collapsed';

            p.enabled = false;
            if ($(list_obj).find('div.' + class_name + ':visible').length > 0) {
                p.enabled = true;
            }
        }
        else if (rcmail.env.task == 'settings' &amp;&amp; p.command == 'delete-folder') {
            p.enabled = false;
            // From rcmail::subscription_select()
            var folder;
            if ((folder = rcmail.env.subscriptionrows[rcmail.env.context_menu_source_id]) &amp;&amp; !folder[2]) {
                p.enabled = true;
            }
        }

        return p;
    },

    ui_button_check: function(btn, active) {
        var classes = (active ? rcmail.contextmenu.settings.classes.button_active : rcmail.contextmenu.settings.classes.button_disabled);
        classes = '.' + classes.replace(/ /g, ', .');

        return $('#' + btn).is(classes);
    },

    settings_menus: function(menus) {
        var default_events = {'init': function(p) {
            // remove options like create, import etc from the settings menu
            // addgroup class is used in Classic skin
            p.ref.container.find('a.addgroup,a.create,a.search,a.import').parent().remove();
        }};

        $.each(menus, function() {
            var menu = this;

            if ($('#' + menu.obj).length > 0) {
                rcmail.addEventListener('init', function() {
                    if (menu.props.init_func) {
                        rcmail.contextmenu[menu.props.init_func]('#' + menu.obj, menu.props, menu.events || default_events);
                    }
                    else if (rcmail[menu.props.list_object]) {
                        rcmail.contextmenu.init_list(menu.obj, menu.props, menu.events || default_events);

                        rcmail[menu.props.list_object].addEventListener('initrow', function(props) {
                            rcmail.contextmenu.init_list(props.id, menu.props, menu.events || default_events);
                        });
                    }
                });
            }
            else if (menu.props.list_object &amp;&amp; menu.props.list_id) {
                rcmail.addEventListener('initlist', function(props) {
                    if ($(props.obj).attr('id') == menu.props.list_id) {
                        rcmail[menu.props.list_object].addEventListener('initrow', function(props) {
                            rcmail.contextmenu.init_list(props.id, menu.props, menu.events || default_events);
                        });
                    }
                });
            }
        });
    }
};

// backwards compatibility, functions renamed in v3.0
function rcm_listmenu_init(row, props, events) { rcm_log('rcm_listmenu_init'); rcmail.contextmenu.init_list(row, props, events); }
function rcm_foldermenu_init(el, props, events) { rcm_log('rcm_foldermenu_init'); rcmail.contextmenu.init_folder(el, props, events); }
function rcm_abookmenu_init(el, props, events) { rcm_log('rcm_abookmenu_init'); rcmail.contextmenu.init_addressbook(el, props, events); }
function rcm_callbackmenu_init(props, ext_events) { rcm_log('rcm_callbackmenu_init'); return rcmail.contextmenu.init(props, ext_events); }
function rcm_show_menu(e, obj, id, menu) { rcm_log('rcm_show_menu'); rcmail.contextmenu.show_one(e, obj, id, menu); }
function rcm_hide_menu(e, sub_only, no_trigger) { rcm_log('rcm_hide_menu'); rcmail.contextmenu.hide_all(e, sub_only, no_trigger); }
function rcm_check_button_state(btn, active) { rcm_log('rcm_check_button_state'); return rcmail.contextmenu.ui_button_check(btn, active); }
function rcm_log(fname) { console.log('Roundcube ContextMenu plugin: Use of ' + fname + ' is depreciated. This will be removed in future versions.'); }

function rcube_context_menu(p) {
    this.menu_name = null;
    this.menu_source = new Array();
    this.menu_source_obj = null;
    this.list_object = null;
    this.mouseover_timeout = rcmail.env.contextmenu_mouseover_timeout;
    this.classes = {
        source: 'contextRow context-source', // contextRow class depreciated in v3.0
        ul: 'toolbarmenu iconized',
        a: 'icon',
        span: 'icon',
        sub_button_a: null,
        sub_button_span: 'right-arrow sub-button' // right-arrow class depreciated in v3.0
    }

    this.modal = false;
    this.is_submenu = false;
    this.submenu_position = 'right';
    this.skinable = false;
    this.parents = 0;
    this.parent_menu = this;
    this.parent_object = null;
    this.selected_object = null
    this.container = null;
    this.menu_selection = new Array();
    this.submenus = {};
    this.timers = {};

    // add global config defaults and instance config
    $.extend(true, this, rcmail.contextmenu.settings.menu_defaults, p);

    // ensure manu_source option is always an array
    if (typeof this.menu_source == 'string')
        this.menu_source = [this.menu_source];

    var ref = this;

    this.init = function() {
        if (!this.container) {
            rcmail.triggerEvent('contextmenu_init', this);

            this.container = $('&lt;div>').attr('id', 'rcm_' + this.menu_name).css('display', 'none');
            this.container.addClass(rcmail.contextmenu.settings.classes.container);
            this.container.addClass(this.is_submenu ? rcmail.contextmenu.settings.classes.submenu : rcmail.contextmenu.settings.classes.mainmenu);

            var rows = [], ul = $('&lt;ul role="menu">'),
            li = $('&lt;li>'), link = $('&lt;a>'), span = $('&lt;span>');

            ul.addClass(this.classes.ul);
            li.attr('role', 'menuitem');

            link.attr({'href': '#', 'role': 'button', 'tabindex': '-1', 'aria-disabled': 'true'});
            link.addClass(this.classes.a);

            span.addClass(this.classes.span);

            this.menu_source_obj = {};
            $.each(this.menu_source, function(i) {
                var source_elements;
                if (typeof ref.menu_source[i] == 'string') {
                    ref.menu_source_obj[ref.menu_source[i]] = {
                        'toggle': !$(ref.menu_source[i]).is(':visible')
                    };
                    source_elements = $(ref.menu_source[i]).children();
                }
                else {
                    ref.menu_source_obj[i] = {
                        'toggle': false
                    };
                    source_elements = $(ref.menu_source[i]);
                }

                ul.attr('aria-labelledby', $(ref.menu_source[i]).attr('aria-labelledby'));

                $.each(source_elements, function() {
                    var src_elem, elem, command, args;

                    var callback = ref.triggerEvent('addmenuitem', {ref: ref, el: this});
                    if (!callback || (!callback.abort &amp;&amp; !callback.result)) {
                        if ($(this).is('li')&amp;&amp; $(this).children().length == 1) {
                            src_elem = $(this).children()[0];
                        }
                        else {
                            src_elem = this;
                        }

                        if ($(src_elem).is('a')) {
                            elem = $(src_elem).clone();

                            if (!elem[0].hasAttribute('onclick') || !elem.attr('onclick').match(rcmail.contextmenu.settings.command_pattern)) {
                                if (elem[0].hasAttribute(rcmail.contextmenu.settings.popup_attrib) &amp;&amp; !elem.attr(rcmail.contextmenu.settings.popup_attrib).match(rcmail.contextmenu.settings.popup_pattern)) {
                                    return;
                                }
                            }
                        }
                        else if ($(src_elem).is('span') &amp;&amp; $(src_elem).children().length == 2) {
                            elem = $(src_elem).children().first().clone();

                            if ($(src_elem).children().last().attr(rcmail.contextmenu.settings.popup_attrib).match(rcmail.contextmenu.settings.popup_pattern)) {
                                $(elem).attr(rcmail.contextmenu.settings.popup_attrib, $(src_elem).children().last().attr(rcmail.contextmenu.settings.popup_attrib));
                                $(elem).addClass('rcm-uidropdown');
                            }
                        }
                        else if ($(src_elem).parent().is('a')) {
                            elem = $(src_elem).parent().clone();
                        }
                        else if (src_elem.command &amp;&amp; src_elem.label) {
                            elem = $('&lt;a>').attr({'id': 'rcmjs', 'href': '#', 'onclick': "return rcmail.command('"+ src_elem.command +"','"+ src_elem.props +"',src_elem,event)"})
                                    .addClass(src_elem.classes)
                                    .html(src_elem.label);
                        }
                        else {
                            return;
                        }
                    }
                    else if (callback.abort) {
                        return;
                    }
                    else {
                        elem = callback.result;
                    }

                    // turn custom popup function into onclick
                    if (rcmail.contextmenu.settings.popup_func.length > 0 &amp;&amp; elem[0].hasAttribute(rcmail.contextmenu.settings.popup_attrib) &amp;&amp; elem.attr(rcmail.contextmenu.settings.popup_attrib).match(rcmail.contextmenu.settings.popup_pattern)) {
                        elem.attr('onclick', elem.attr(rcmail.contextmenu.settings.popup_attrib).replace(rcmail.contextmenu.settings.popup_pattern, rcmail.contextmenu.settings.popup_func));
                    }

                    // skip any element that does not look like a Roundcube button
                    if (!elem[0].hasAttribute('onclick')) {
                        return;
                    }

                    command = '';
                    var matches;
                    if (matches = elem.attr('onclick').match(rcmail.contextmenu.settings.command_pattern)) {
                        command = matches[1];
                        args = matches[2];
                    }

                    // skip elements we don't need
                    if ($.inArray(rcmail.env.task + '-' + command, rcmail.contextmenu.settings.skip_commands) >= 0 || elem.hasClass('rcm_ignore') || elem.hasClass('rcm-ignore')) { // rcm_ignore class depreciated in v3.0
                        return;
                    }

                    var a = link.clone(), row = li.clone();

                    // add command name element
                    var tmp = span.clone();
                    var label = elem.text().trim();
                    tmp.text(label.length > 0 ? label : elem.attr('title'));
                    tmp.addClass(elem.children('span').attr('class'));
                    a.append(tmp);
                    a.addClass(elem.attr('class'));
                    a.removeClass(rcmail.contextmenu.settings.classes.button_remove);
                    a.removeClass(rcmail.contextmenu.settings.classes.button_disabled);
                    a.addClass('rcm_elem_' + elem.attr('id'));

                    if (matches = elem.attr('onclick').match(rcmail.contextmenu.settings.popup_pattern)) {
                        // check the popup menu exists
                        var popup_id = rcmail.gui_containers[matches[1]] ? rcmail.gui_containers[matches[1]].attr('id') : matches[1];
                        if ($('#' + popup_id).length == 0) {
                            return;
                        }

                        a.data('command', matches[1]);
                        a.data('menu-pos', ref.submenu_position);
                        a.addClass(ref.classes.sub_button_a);
                        if (ref.classes.sub_button_span)
                            a.append($('&lt;span>').addClass(ref.classes.sub_button_span));
                        row.addClass(rcmail.contextmenu.settings.classes.submenu);
                        a.on('click', function(e) {
                            if (!$(this).is('.' + rcmail.contextmenu.settings.classes.button_active.replace(/ /g, ', .')))
                                return;

                            ref.submenu(a, e);
                            return false;
                        })
                        .on('mouseover', function(e) {
                            if (ref.mouseover_timeout &lt; 0)
                                return;

                            var el = this;
                            ref.timers['submenu_show'] = window.setTimeout(function(a, e) {
                                if (!$(el).is('.' + rcmail.contextmenu.settings.classes.button_active.replace(/ /g, ', .'))) {
                                    rcmail.contextmenu.hide_all(e, true);
                                }
                                else {
                                    ref.submenu(a, e);
                                }
                            }, ref.mouseover_timeout, a, e);
                        })
                        .on('mouseout', function() {
                            if (ref.mouseover_timeout &lt; 0 || !$(this).is('.' + rcmail.contextmenu.settings.classes.button_active.replace(/ /g, ', .')))
                                return;

                            $(this).blur();
                            clearTimeout(ref.timers['submenu_show']);
                        });
                    }
                    else {
                        // skip elements for which we could not identify a command
                        if (!command) {
                            return;
                        }

                        a.addClass('cmd_' + command.replace(/\./g, '-'));
                        a.data('command', command);
                        if (elem.attr('target'))
                            a.attr('target', elem.attr('target'));

                        a.on('click', function(e) {
                            if ($(this).parents('div.' + rcmail.contextmenu.settings.classes.submenu.replace(/ /g, '.')).length == 0) {
                                rcmail.contextmenu.hide_all(e, true);
                                clearTimeout(ref.timers['submenu_hide']);
                            }

                            var cur_popups = rcmail.contextmenu.vars.popup_menus.length;
                            var result;

                            var callback = ref.parent_menu.triggerEvent('beforecommand', {ref: ref, el: this, command: command, args: args});
                            if (!callback || !callback.abort) {
                                result = ref.parent_menu.triggerEvent('command', {ref: ref, el: this, command: command, args: args, evt: e});
                            }
                            else {
                                result = callback.result;
                            }

                            if (!callback || !callback.skipaftercommand)
                                ref.parent_menu.triggerEvent('aftercommand', {ref: ref, el: this, command: command, args: args});

                            // ensure menu is always hidden after action
                            ref.parent_menu.hide_menu(e);

                            return result;
                        });

                        if (ref.mouseover_timeout > -1 &amp;&amp; !ref.is_submenu) {
                            a.mouseover(function(e) {
                                ref.timers['submenu_hide'] = window.setTimeout(function(e) {
                                    rcmail.contextmenu.hide_all(e, true);
                                }, ref.mouseover_timeout, e);
                            });

                            a.mouseout(function() { clearTimeout(ref.timers['submenu_hide']); });
                        }
                    }

                    row.append(a);
                    ref.parent_menu.triggerEvent('insertitem', {ref: ref, item: row, originalElement: elem});
                    rows.push(row);
                });
            });

            ul.append(rows).appendTo(this.container);
            this.parent_menu.triggerEvent('init', {ref: this});
            this.container.appendTo($('body'));
        }
    };

    this.show_menu = function(obj, e) {
        if (obj) {
            this.hide_menu(e);
        }

        var callback = this.parent_menu.triggerEvent('beforeactivate', {ref: this, source: obj, originalEvent: e});
        if (!callback || !callback.abort) {
            // don't add source class when selected row is part of current selection, current selection is styled already (#113)
            if (obj &amp;&amp; !(this.list_object &amp;&amp; rcmail[this.list_object].in_selection(rcmail.env.context_menu_source_id))) {
                $(obj).addClass(this.classes.source);
            }

            if (this.modal &amp;&amp; !this.is_submenu &amp;&amp; ($('#rcm_modal').length == 0 || (rcmail.contextmenu.settings.classes.modal_overlay &amp;&amp; $('.' + rcmail.contextmenu.settings.classes.modal_overlay.replace(/ /g, '.')).length == 0))) {
                $('&lt;div>').attr('id', 'rcm_modal').addClass(rcmail.contextmenu.settings.classes.modal_overlay)
                    .on('contextmenu', function(e) { $(e.target).trigger('click'); rcube_event.cancel(e); })
                    .insertBefore('#rcm_' + this.menu_name);
            }

            $.each(ref.menu_source_obj, function(id, props) {
                if (props.toggle) {
                    // wait for return
                    var ret = ref.parent_menu.triggerEvent('submenu_toggle', {id: id, ref: ref, show: true});
                }
            });

            $.each(this.container.find('a'), function() {
                var btn;
                if ($(this).hasClass('rcm_active') || $(this).hasClass('rcm-active')) { // rcm_active class depreciated in v3.0
                    $(this).addClass(rcmail.contextmenu.settings.classes.button_active);
                }
                else if (btn = $(this).attr('class').match(/rcm_elem_([a-z0-9]+)/)) {
                    $(this).parent('li')[(btn[1] == 'rcmjs' || $('#' + btn[1]).is(':visible')) ? 'show' : 'hide']();
                    $(this).removeClass(rcmail.contextmenu.settings.classes.button_active).removeClass(rcmail.contextmenu.settings.classes.button_disabled);

                    var enabled = false;
                    if ($(this).parent('li').is('.' + rcmail.contextmenu.settings.classes.submenu.replace(/ /g, ', .'))) {
                        // check of active commands in submenu to activate submenu link (https://github.com/roundcube/roundcubemail/issues/6444)
                        // based on rcmail.set_menu_buttons()
                        var id = rcmail.gui_containers[$(this).data('command')] ? rcmail.gui_containers[$(this).data('command')].attr('id') : $(this).data('command');
                        if (rcmail.menu_buttons[id]) {
                            $.each(rcmail.menu_buttons[id][1], function() {
                                var is_func = typeof(this) == 'function';
                                if ((is_func &amp;&amp; this()) || (!is_func &amp;&amp; rcmail.commands[this])) {
                                    return !(enabled = true);
                                }
                            });
                        }
                        else {
                            // cant find the submenu, enable the link just in case
                            enabled = true;
                        }
                    }
                    else if (!rcmail.contextmenu.ui_button_check(btn[1], false) &amp;&amp; (!ref.is_submenu || rcmail.contextmenu.ui_button_check(btn[1], true))) {
                        enabled = true;
                    }

                    var args = {ref: ref, el: this, btn: btn[1], source: obj, command: $(this).data('command'), enabled: enabled};
                    var p = ref.parent_menu.triggerEvent('activate', args);

                    if (typeof(p) === "boolean") { // backwards compatibility pre v3.0
                        args.enabled = p;
                        p = args;
                    }
                    else if (!p) {
                        p = args;
                    }

                    if (!p.abort) {
                        $(this).addClass(p.enabled == true ? rcmail.contextmenu.settings.classes.button_active : rcmail.contextmenu.settings.classes.button_disabled);
                    }
                }
            });

            $.each(ref.menu_source_obj, function(id, props) {
                if (props.toggle) {
                    // wait for return
                    var ret = ref.parent_menu.triggerEvent('submenu_toggle', {id: id, ref: ref, show: false});
                }
            });

            this.parent_menu.triggerEvent('afteractivate', {ref: this, source: obj, originalEvent: e});
        }

        // sanity check, make sure there are items contained in the menu
        if (this.container.find('li > a').length == 0) {
            $('.' + this.classes.source.replace(/ /g, '.')).removeClass(this.classes.source);
            return;
        }

        // position menu on the screen
        if (this.is_submenu) {
            rcmail.element_position(this.container, this.parent_object);
        }
        else {
            this.position(e, this.container);
        }

        if (!callback || callback.show !== false) {
            this.selected_object = obj;
            this.container.show();
            rcmail.triggerEvent('menu-open', { name: this.container.attr('id'), props:{ menu: this.container.attr('id'), skinable: this.skinable }, originalEvent: e });
        }
    };

    this.hide_menu = function(e) {
        if ($('div.' + rcmail.contextmenu.settings.classes.container.replace(/ /g, '.')).is(':visible') &amp;&amp; (rcmail.contextmenu.vars.popup_menus.length == 0 || $(e.target).parents('div.' + rcmail.contextmenu.settings.classes.container.replace(/ /g, '.')).length == 0)) {
            if (!this.is_submenu) {
                this.selected_object = null;
                $('.' + this.classes.source.replace(/ /g, '.')).removeClass(this.classes.source);

                if (this.modal)
                    $('#rcm_modal').remove();
            }

            // if the menu has submenus they should be hidden to
            $.each(this.submenus, function() {
                this.container.hide();
            });

            this.menu_selection = new Array(); // reset selection ready for next event
            this.container.hide();
            this.parent_menu.triggerEvent('hide_menu', { ref: this, originalEvent: e });
        }
    };

    this.submenu = function(link, e) {
        if (e) {
            rcube_event.cancel(e);
        }

        rcmail.contextmenu.hide_all(e, true);

        var id = rcmail.gui_containers[$(link).data('command')] ? rcmail.gui_containers[$(link).data('command')].attr('id') : $(link).data('command');
        if (!this.submenus[id]) {
            var elem = !$('#' + id).is('ul') ? '#' + id + ' ul' : '#' + id; // check if the container returned is a ul else there should be one directly beneath it
            this.submenus[id] = new rcube_context_menu({'menu_name': id, 'menu_source': elem, 'parents': (this.parents + 1), 'parent_menu': this, 'parent_object': link, 'is_submenu': true, 'list_object': this.list_object});
            this.submenus[id].init();
        }

        this.submenus[id].show_menu(null, e);
    };

    this.position = function(e, menu) {
        // temporarily show element to calculate its size
        menu.css({left: '-1000px', top: '-1000px'}).show();

        var win = $(window),
        win_height = win.height(),
        elem_height = $(menu).height(),
        elem_width = $(menu).width(),
        top = e.pageY,
        left = e.pageX;

        if (top + elem_height > win_height) {
            top -= elem_height;

            if (top &lt; 0)
                top = Math.max(0, (win_height - elem_height) / 2);
        }

        if (left + elem_width > win.width())
            left -= ((left + elem_width) - win.width()) + 10;

        // sanity check
        if (left &lt; 0) left = 0;

        menu.hide();
        menu.css({left: left + 'px', top: top + 'px'});
    };

    this.destroy = function() {
        $.each(this.submenus, function() {
            this.destroy();
        });

        // remove the menu from the UI
        this.container.remove();

        if (this.is_submenu)
            delete rcmail.env.contextmenus[this.parent_menu.menu_name].submenus[this.menu_name];
        else
            delete rcmail.env.contextmenus[this.menu_name];
    };

    this.addEventListener = rcube_event_engine.prototype.addEventListener;
    this.removeEventListener = rcube_event_engine.prototype.removeEventListener;
    this.triggerEvent = rcube_event_engine.prototype.triggerEvent;
}

$(document).ready(function() {
    if (window.rcmail) {
        rcmail.env.contextmenus = {};

        // backwards compatibility with old settings code removed in v3.0
        var old_settings = ['context_menu_skip_commands', 'context_menu_overload_commands', 'context_menu_command_pattern', 'context_menu_popup_pattern', 'context_menu_button_active_class', 'context_menu_button_disabled_class'];
        $.each(old_settings, function() {
            if (rcmail[this]) {
                rcm_log('rcmail.' + this);
                var opt = this.replace(/^context_menu_/, '');

                if ((this == 'context_menu_button_active_class' || this == 'context_menu_button_disabled_class') &amp;&amp; $.isArray(rcmail[this])) {
                    rcmail.contextmenu.settings[opt] = rcmail[this].join(' ');
                }
                else {
                    rcmail.contextmenu.settings[opt] = rcmail[this];
                }
            }
        });

        rcmail.addEventListener('init', function() {
            // no need to reattach events inside iframe
            if (rcmail.is_framed())
                return;

            var body_mouseup = function(e) {
                $.each(rcmail.env.contextmenus, function() {
                    if (rcmail.contextmenu.settings.no_right_click_on_menu &amp;&amp; e.which == 3 &amp;&amp; $(e.target).parents('.contextmenu').length > 0) {
                        // useability - on the contextmenu make right click the same as left (sometimes users think they have to right click because they right clicked to get there)
                        $(e.target).trigger('click');
                        rcube_event.cancel(e);
                    }
                    else {
                        rcmail.contextmenu.hide_all(e);
                    }
                });
            };
            $(document.body).on('click contextmenu', body_mouseup);

            // Hide menu after clicks in iframes (eg. preview pane)
            $('iframe').on('load', function() {
                try { $(this.contentDocument || this.contentWindow).on('mouseup', body_mouseup) }
                catch (e) { /* catch possible "Permission denied" error in IE */ }
            })
            .contents().on('mouseup', body_mouseup);
        });

        rcmail.register_command('plugin.contextmenu.collapseall', function(obj) {
            rcmail[obj].collapse_all();
        }, true);

        rcmail.register_command('plugin.contextmenu.expandall', function(obj) {
            rcmail[obj].expand_all();
        }, true);

        rcmail.register_command('plugin.contextmenu.openextwin', function() {
            var button_id = rcmail.buttons['plugin.contextmenu.openextwin'][0].id;

            if (rcmail.env.task == 'settings') {
                rcube_find_object(button_id).href = '?_task=settings&amp;_action=' + urlencode(rcmail.env.context_menu_source_id);
            }
            else {
                rcube_find_object(button_id).href = '?_task=mail&amp;_mbox=' + urlencode(rcmail.env.context_menu_source_id);
            }

            rcmail.sourcewin = window.open(rcube_find_object(button_id).href);
            if (rcmail.sourcewin)
                window.setTimeout(function() { rcmail.sourcewin.focus(); }, 20);

            rcube_find_object(button_id).href = '#';
        }, false);

        rcmail.register_command('plugin.contextmenu.openinline', function() {
            rcmail.goto_url('settings/' + rcmail.env.context_menu_source_id, {_framed: 0});
        }, false);

        // special event listeners for interacting with plugins which open popup menus (eg: zipdownload)
        rcmail.addEventListener('menu-open', function(p) {
            // check for popupmenus that arent part of contextmenu
            if ($('div.' + rcmail.contextmenu.settings.classes.container.replace(/ /g, '.')).is(':visible') &amp;&amp; p.name.indexOf('rcm_') != 0) {
                // keep track of whats open
                rcmail.contextmenu.vars.popup_menus.push(p.name);
            }
        });

        rcmail.addEventListener('menu-close', function(p) {
            // keep track of whats open
            var idx;
            if ((idx = $.inArray(p.name, rcmail.contextmenu.vars.popup_menus)) >= 0) {
                rcmail.contextmenu.vars.popup_menus.splice(idx, 1);
            }

            // check required args are present, other plugins trigger this event too
            if (p.originalEvent &amp;&amp; $('div.' + rcmail.contextmenu.settings.classes.container.replace(/ /g, '.')).is(':visible')) {
                var e = p.originalEvent.currentTarget ? p.originalEvent.currentTarget : p.originalEvent.srcElement;
                // check target is an HTML Element (ie not HTML Document #105)
                if (e instanceof HTMLElement) {
                    // check if target is in a contextmenu, and is so hide the menu
                    if (p.name.indexOf('rcm_') != 0 &amp;&amp; $(e).prop('class').indexOf('rcm_elem_') == -1) {
                        rcmail.contextmenu.hide_all(p.originalEvent, false, true);
                    }
                }
            }
        });
    }
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BaseStorage.html">BaseStorage</a></li><li><a href="module-Color.html">Color</a></li><li><a href="module-Log.html">Log</a></li><li><a href="module-MEL_ELASTIC_UI.html">MEL_ELASTIC_UI</a></li><li><a href="module-MelLinq.html">MelLinq</a></li></ul><h3>Namespaces</h3><ul><li><a href="MelMetapage.html">MelMetapage</a></li><li><a href="OCA.Bnum.html">Bnum</a></li><li><a href="OCA.Bnum.App.html">App</a></li><li><a href="Skins.html">Skins</a></li><li><a href="Utilities.html">Utilities</a></li><li><a href="animation.html">animation</a></li><li><a href="aria.html">aria</a></li></ul><h3>Classes</h3><ul><li><a href="AMelScreenManager.html">AMelScreenManager</a></li><li><a href="Alarm.html">Alarm</a></li><li><a href="AlarmData.html">AlarmData</a></li><li><a href="AlarmPart.html">AlarmPart</a></li><li><a href="AudioVisualizer.html">AudioVisualizer</a></li><li><a href="BnumConnector.html">BnumConnector</a></li><li><a href="CalendarEvent.html">CalendarEvent</a></li><li><a href="CalendarLoader.html">CalendarLoader</a></li><li><a href="Calendar_Alarm.html">Calendar_Alarm</a></li><li><a href="CategoryData.html">CategoryData</a></li><li><a href="CategoryPart.html">CategoryPart</a></li><li><a href="ChatManager.html">ChatManager</a></li><li><a href="Connector.html">Connector</a></li><li><a href="EventField.html">EventField</a></li><li><a href="EventListenerDatas.html">EventListenerDatas</a></li><li><a href="EventManager.html">EventManager</a></li><li><a href="EventParts.html">EventParts</a></li><li><a href="EventView.html">EventView</a></li><li><a href="FreeBusyGuests.html">FreeBusyGuests</a></li><li><a href="GlobalModal.html">GlobalModal</a></li><li><a href="GlobalModalConfig.html">GlobalModalConfig</a></li><li><a href="GuestsPart_GuestsPart.html">GuestsPart</a></li><li><a href="IExt.html">IExt</a></li><li><a href="IntegratedVisio.html">IntegratedVisio</a></li><li><a href="InternalWebconfScreenManager.html">InternalWebconfScreenManager</a></li><li><a href="ListenerWebConfBar.html">ListenerWebConfBar</a></li><li><a href="MasterWebconfBar.html">MasterWebconfBar</a></li><li><a href="MasterWebconfBarItem.html">MasterWebconfBarItem</a></li><li><a href="MasterWebconfBarPopup.html">MasterWebconfBarPopup</a></li><li><a href="MelAudioManager.html">MelAudioManager</a></li><li><a href="MelAudioStruct.html">MelAudioStruct</a></li><li><a href="MelDataStore.html">MelDataStore</a></li><li><a href="MelIconPrevisualiser.html">MelIconPrevisualiser</a></li><li><a href="MelListingPrevisualiser.html">MelListingPrevisualiser</a></li><li><a href="MelNews.html">MelNews</a></li><li><a href="MelObject.html">MelObject</a></li><li><a href="MelPrevisualiser.html">MelPrevisualiser</a></li><li><a href="Mel_Promise.html">Mel_Promise</a></li><li><a href="MetapageModule.html">MetapageModule</a></li><li><a href="NewsPopup.html">NewsPopup</a></li><li><a href="Nextcloud_Document.html">Nextcloud_Document</a></li><li><a href="Nextcloud_Document_Config.html">Nextcloud_Document_Config</a></li><li><a href="Nextcloud_File.html">Nextcloud_File</a></li><li><a href="Nextcloud_Icon.html">Nextcloud_Icon</a></li><li><a href="Nextcloud_Response.html">Nextcloud_Response</a></li><li><a href="NotifierObject.html">NotifierObject</a></li><li><a href="OCA.Bnum.FileList.html">FileList</a></li><li><a href="ParapheurAction.html">ParapheurAction</a></li><li><a href="ParapheurMailAction.html">ParapheurMailAction</a></li><li><a href="RcmailDialog.html">RcmailDialog</a></li><li><a href="RcmailDialogButton.html">RcmailDialogButton</a></li><li><a href="RcmailDialogChoiceButton.html">RcmailDialogChoiceButton</a></li><li><a href="RightPannel.html">RightPannel</a></li><li><a href="SearchResult.html">SearchResult</a></li><li><a href="SearchResultCalendar.html">SearchResultCalendar</a></li><li><a href="Slot.html">Slot</a></li><li><a href="Slots.html">Slots</a></li><li><a href="SplittedDate.html">SplittedDate</a></li><li><a href="Sticker.html">Sticker</a></li><li><a href="TEActiveMouse.html">TEActiveMouse</a></li><li><a href="TEContainerActiveClassCtrl.html">TEContainerActiveClassCtrl</a></li><li><a href="TEErrorHandler.html">TEErrorHandler</a></li><li><a href="TEHashCtrl.html">TEHashCtrl</a></li><li><a href="TEHideIfNotActiveCtrl.html">TEHideIfNotActiveCtrl</a></li><li><a href="TEOverflowCtrl.html">TEOverflowCtrl</a></li><li><a href="TEOverflowScrollCtrl.html">TEOverflowScrollCtrl</a></li><li><a href="TEOverflowTransformCtrl.html">TEOverflowTransformCtrl</a></li><li><a href="Title.html">Title</a></li><li><a href="VisioManager.html">VisioManager</a></li><li><a href="VisualiserObject.html">VisualiserObject</a></li><li><a href="VisualiserObjectEx_VisualiserObjectEx.html">VisualiserObjectEx</a></li><li><a href="WarningPanel.html">WarningPanel</a></li><li><a href="Webconf.html">Webconf</a></li><li><a href="WebconfChat.html">WebconfChat</a></li><li><a href="WebconfPageCreator.html">WebconfPageCreator</a></li><li><a href="WebconfScreenManager.html">WebconfScreenManager</a></li><li><a href="WebconfWorkspaceManager.html">WebconfWorkspaceManager</a></li><li><a href="aria.Dialog.html">Dialog</a></li><li><a href="html_events.html">html_events</a></li><li><a href="html_li.html">html_li</a></li><li><a href="html_ul.html">html_ul</a></li><li><a href="mail_html_mail_html.html">mail_html</a></li><li><a href="mel_cancellable_html_timer.html">mel_cancellable_html_timer</a></li><li><a href="mel_filter.html">mel_filter</a></li><li><a href="mel_html.html">mel_html</a></li><li><a href="mel_html2.html">mel_html2</a></li><li><a href="mel_html_timer.html">mel_html_timer</a></li><li><a href="module-BaseStorage.BaseStorage.html">BaseStorage</a></li><li><a href="module-Color-Color.html">Color</a></li><li><a href="module-Color-ColorRGBA.html">ColorRGBA</a></li><li><a href="module-Log.BnumLog.html">BnumLog</a></li><li><a href="module-MEL_ELASTIC_UI.Mel_Elastic_Storage.html">Mel_Elastic_Storage</a></li><li><a href="module-MEL_ELASTIC_UI-Mel_CSS_Advanced_Rule.html">Mel_CSS_Advanced_Rule</a></li><li><a href="module-MEL_ELASTIC_UI-Mel_CSS_Array_Rule.html">Mel_CSS_Array_Rule</a></li><li><a href="module-MEL_ELASTIC_UI-Mel_CSS_Rule.html">Mel_CSS_Rule</a></li><li><a href="module-MEL_ELASTIC_UI-Mel_CSS_Style_Sheet.html">Mel_CSS_Style_Sheet</a></li><li><a href="module-MEL_ELASTIC_UI-Mel_Elastic.html">Mel_Elastic</a></li><li><a href="module-MelLinq-MelEnumerable.html">MelEnumerable</a></li><li><a href="module-MelLinq-MelKeyValuePair.html">MelKeyValuePair</a></li><li><a href="rcube_splitter.html">rcube_splitter</a></li><li><a href="search.html">search</a></li><li><a href="searchBlock.html">searchBlock</a></li><li><a href="window.TEPauseCtrl.html">TEPauseCtrl</a></li></ul><h3>Events</h3><ul><li><a href="AlarmPart.html#event:onChange">onChange</a></li><li><a href="CategoryPart.html#event:onChange">onChange</a></li><li><a href="EventView.html#event:before_save">before_save</a></li><li><a href="EventView.html#event:on_dialog_before_close">on_dialog_before_close</a></li><li><a href="EventView.html#event:on_drop">on_drop</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Cette">Cette</a></li><li><a href="global.html#DAY_MS">DAY_MS</a></li><li><a href="global.html#DeleteLink">DeleteLink</a></li><li><a href="global.html#End">End</a></li><li><a href="global.html#Enum%25C3%25A9ration">Enumération</a></li><li><a href="global.html#GetLinkPopUp">GetLinkPopUp</a></li><li><a href="global.html#HOUR_MS">HOUR_MS</a></li><li><a href="global.html#Middle">Middle</a></li><li><a href="global.html#Mode">Mode</a></li><li><a href="global.html#Nextcloud">Nextcloud</a></li><li><a href="global.html#Nombres">Nombres</a></li><li><a href="global.html#PDFFindBar">PDFFindBar</a></li><li><a href="global.html#PDFFindController">PDFFindController</a></li><li><a href="global.html#Plugin">Plugin</a></li><li><a href="global.html#Portail">Portail</a></li><li><a href="global.html#RoundriveCreate">RoundriveCreate</a></li><li><a href="global.html#SELECTOR_CLASS_ROUND_CALENDAR">SELECTOR_CLASS_ROUND_CALENDAR</a></li><li><a href="global.html#Start">Start</a></li><li><a href="global.html#TEOnlyOnePlayingCtrl">TEOnlyOnePlayingCtrl</a></li><li><a href="global.html#TESessionCurrentSubtitle">TESessionCurrentSubtitle</a></li><li><a href="global.html#TESwipeCtrl">TESwipeCtrl</a></li><li><a href="global.html#TextLayerBuilder">TextLayerBuilder</a></li><li><a href="global.html#Tri">Tri</a></li><li><a href="global.html#URL">URL</a></li><li><a href="global.html#Update">Update</a></li><li><a href="global.html#ViewHistory">ViewHistory</a></li><li><a href="global.html#WSPReady">WSPReady</a></li><li><a href="global.html#_on_mention_update">_on_mention_update</a></li><li><a href="global.html#add_mobile_class">add_mobile_class</a></li><li><a href="global.html#api_notifications">api_notifications</a></li><li><a href="global.html#audio_alarms">audio_alarms</a></li><li><a href="global.html#audiourltotest">audiourltotest</a></li><li><a href="global.html#base_color">base_color</a></li><li><a href="global.html#base_text_color">base_text_color</a></li><li><a href="global.html#changeType">changeType</a></li><li><a href="global.html#checkAllIdentities">checkAllIdentities</a></li><li><a href="global.html#checkOneIdentity">checkOneIdentity</a></li><li><a href="global.html#check_workspace_integrity">check_workspace_integrity</a></li><li><a href="global.html#command_parapheur">command_parapheur</a></li><li><a href="global.html#componentToHex">componentToHex</a></li><li><a href="global.html#copy_signature">copy_signature</a></li><li><a href="global.html#createImage">createImage</a></li><li><a href="global.html#createLogo">createLogo</a></li><li><a href="global.html#createLogoType">createLogoType</a></li><li><a href="global.html#current_desktop_notification">current_desktop_notification</a></li><li><a href="global.html#date2ISO8601">date2ISO8601</a></li><li><a href="global.html#date2unixtime">date2unixtime</a></li><li><a href="global.html#datetimepickerFactory">datetimepickerFactory</a></li><li><a href="global.html#default_note_uid">default_note_uid</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#dialog">dialog</a></li><li><a href="global.html#dismiss_alarm">dismiss_alarm</a></li><li><a href="global.html#display_alarms">display_alarms</a></li><li><a href="global.html#dkSiRuleResizeMnu">dkSiRuleResizeMnu</a></li><li><a href="global.html#docReady">docReady</a></li><li><a href="global.html#download">download</a></li><li><a href="global.html#download_signature_outlook_htm">download_signature_outlook_htm</a></li><li><a href="global.html#download_signature_outlook_zip">download_signature_outlook_zip</a></li><li><a href="global.html#download_signature_thunderbird">download_signature_thunderbird</a></li><li><a href="global.html#enum_tooltip_mode">enum_tooltip_mode</a></li><li><a href="global.html#enum_tooltip_position">enum_tooltip_position</a></li><li><a href="global.html#ev_calendar_url">ev_calendar_url</a></li><li><a href="global.html#event_date_text">event_date_text</a></li><li><a href="global.html#fluxhtml">fluxhtml</a></li><li><a href="global.html#fluxrss">fluxrss</a></li><li><a href="global.html#folder_collapse">folder_collapse</a></li><li><a href="global.html#folder_collapse_unified">folder_collapse_unified</a></li><li><a href="global.html#folder_count">folder_count</a></li><li><a href="global.html#folder_count_unified">folder_count_unified</a></li><li><a href="global.html#folder_expand">folder_expand</a></li><li><a href="global.html#formatPhoneNumber">formatPhoneNumber</a></li><li><a href="global.html#format_datetime">format_datetime</a></li><li><a href="global.html#format_time">format_time</a></li><li><a href="global.html#fromunixtime">fromunixtime</a></li><li><a href="global.html#generate_canvas">generate_canvas</a></li><li><a href="global.html#getOutputScale">getOutputScale</a></li><li><a href="global.html#getPDFFileNameFromURL">getPDFFileNameFromURL</a></li><li><a href="global.html#getSignatureHTML">getSignatureHTML</a></li><li><a href="global.html#getTime">getTime</a></li><li><a href="global.html#get_organizer">get_organizer</a></li><li><a href="global.html#has_attendees">has_attendees</a></li><li><a href="global.html#has_permission">has_permission</a></li><li><a href="global.html#hide_header_row">hide_header_row</a></li><li><a href="global.html#init_recurrence_edit">init_recurrence_edit</a></li><li><a href="global.html#init_time_autocomplete">init_time_autocomplete</a></li><li><a href="global.html#isArrayLike">isArrayLike</a></li><li><a href="global.html#isAsync">isAsync</a></li><li><a href="global.html#isNullOrUndefined">isNullOrUndefined</a></li><li><a href="global.html#is_attendee">is_attendee</a></li><li><a href="global.html#is_internal_organizer">is_internal_organizer</a></li><li><a href="global.html#is_organizer">is_organizer</a></li><li><a href="global.html#libkolab_audittrail">libkolab_audittrail</a></li><li><a href="global.html#load_next_page">load_next_page</a></li><li><a href="global.html#loader">loader</a></li><li><a href="global.html#m_mp_Create">m_mp_Create</a></li><li><a href="global.html#m_mp_CreateDocumentIconContract">m_mp_CreateDocumentIconContract</a></li><li><a href="global.html#m_mp_CreateEvent">m_mp_CreateEvent</a></li><li><a href="global.html#m_mp_CreateEvent_inpage">m_mp_CreateEvent_inpage</a></li><li><a href="global.html#m_mp_CreateOrOpenFrame">m_mp_CreateOrOpenFrame</a></li><li><a href="global.html#m_mp_Help">m_mp_Help</a></li><li><a href="global.html#m_mp_InitializeDocument">m_mp_InitializeDocument</a></li><li><a href="global.html#m_mp_NotificationFilter">m_mp_NotificationFilter</a></li><li><a href="global.html#m_mp_NotificationGetDate">m_mp_NotificationGetDate</a></li><li><a href="global.html#m_mp_NotificationGetElement">m_mp_NotificationGetElement</a></li><li><a href="global.html#m_mp_NotificationProcess">m_mp_NotificationProcess</a></li><li><a href="global.html#m_mp_NotificationProcessAfterAction">m_mp_NotificationProcessAfterAction</a></li><li><a href="global.html#m_mp_NotificationRefresh">m_mp_NotificationRefresh</a></li><li><a href="global.html#m_mp_NotificationRun">m_mp_NotificationRun</a></li><li><a href="global.html#m_mp_NotificationSettings">m_mp_NotificationSettings</a></li><li><a href="global.html#m_mp_NotificationStartup">m_mp_NotificationStartup</a></li><li><a href="global.html#m_mp_NotificationsAction">m_mp_NotificationsAction</a></li><li><a href="global.html#m_mp_NotificationsAppendFilters">m_mp_NotificationsAppendFilters</a></li><li><a href="global.html#m_mp_NotificationsAppendToPanel">m_mp_NotificationsAppendToPanel</a></li><li><a href="global.html#m_mp_NotificationsClean">m_mp_NotificationsClean</a></li><li><a href="global.html#m_mp_NotificationsDelete">m_mp_NotificationsDelete</a></li><li><a href="global.html#m_mp_NotificationsGet">m_mp_NotificationsGet</a></li><li><a href="global.html#m_mp_NotificationsMerge">m_mp_NotificationsMerge</a></li><li><a href="global.html#m_mp_NotificationsRefreshUnread">m_mp_NotificationsRefreshUnread</a></li><li><a href="global.html#m_mp_NotificationsSet">m_mp_NotificationsSet</a></li><li><a href="global.html#m_mp_NotificationsShowUnread">m_mp_NotificationsShowUnread</a></li><li><a href="global.html#m_mp_NotificationsSort">m_mp_NotificationsSort</a></li><li><a href="global.html#m_mp_OpenTask">m_mp_OpenTask</a></li><li><a href="global.html#m_mp_RizomoRefreshNotifications">m_mp_RizomoRefreshNotifications</a></li><li><a href="global.html#m_mp_ShowDesktopNotification">m_mp_ShowDesktopNotification</a></li><li><a href="global.html#m_mp_ShowNotification">m_mp_ShowNotification</a></li><li><a href="global.html#m_mp_ToggleGroupOptionsUser">m_mp_ToggleGroupOptionsUser</a></li><li><a href="global.html#m_mp_UpdateCreateDoc">m_mp_UpdateCreateDoc</a></li><li><a href="global.html#m_mp_action_from_storage">m_mp_action_from_storage</a></li><li><a href="global.html#m_mp_anchor_ariane">m_mp_anchor_ariane</a></li><li><a href="global.html#m_mp_close_ariane">m_mp_close_ariane</a></li><li><a href="global.html#m_mp_full_screen_ariane">m_mp_full_screen_ariane</a></li><li><a href="global.html#m_mp_get_all_hashtag">m_mp_get_all_hashtag</a></li><li><a href="global.html#m_mp_help_video">m_mp_help_video</a></li><li><a href="global.html#m_mp_set_storage">m_mp_set_storage</a></li><li><a href="global.html#mel_metapage">mel_metapage</a></li><li><a href="global.html#mel_shortcuts_press">mel_shortcuts_press</a></li><li><a href="global.html#menuMgr">menuMgr</a></li><li><a href="global.html#menuScrollTiTask">menuScrollTiTask</a></li><li><a href="global.html#meteo">meteo</a></li><li><a href="global.html#mm_s_Action">mm_s_Action</a></li><li><a href="global.html#mm_s_AfficheResults">mm_s_AfficheResults</a></li><li><a href="global.html#mm_s_CreateOrUpdateFrame">mm_s_CreateOrUpdateFrame</a></li><li><a href="global.html#mm_s_OnClick">mm_s_OnClick</a></li><li><a href="global.html#mm_s_bodyClick">mm_s_bodyClick</a></li><li><a href="global.html#mm_s_extend">mm_s_extend</a></li><li><a href="global.html#modify_signature">modify_signature</a></li><li><a href="global.html#noContextMenuHandler">noContextMenuHandler</a></li><li><a href="global.html#onInputChange">onInputChange</a></li><li><a href="global.html#open_dialog">open_dialog</a></li><li><a href="global.html#parseISO8601">parseISO8601</a></li><li><a href="global.html#parse_datetime">parse_datetime</a></li><li><a href="global.html#plugin_text">plugin_text</a></li><li><a href="global.html#rcm_tb_label_insert">rcm_tb_label_insert</a></li><li><a href="global.html#rcm_tb_label_submenu">rcm_tb_label_submenu</a></li><li><a href="global.html#rcube_libcalendaring">rcube_libcalendaring</a></li><li><a href="global.html#rcube_mail_ui">rcube_mail_ui</a></li><li><a href="global.html#rcube_scroller">rcube_scroller</a></li><li><a href="global.html#rcube_tasklist">rcube_tasklist</a></li><li><a href="global.html#rcube_tasklist_ui">rcube_tasklist_ui</a></li><li><a href="global.html#rgbToHex">rgbToHex</a></li><li><a href="global.html#save_option">save_option</a></li><li><a href="global.html#saving_lock">saving_lock</a></li><li><a href="global.html#scImgMgr">scImgMgr</a></li><li><a href="global.html#scSiRuleEnsureVisible">scSiRuleEnsureVisible</a></li><li><a href="global.html#scrollIntoView">scrollIntoView</a></li><li><a href="global.html#send_francetransfert_message">send_francetransfert_message</a></li><li><a href="global.html#send_melanissimo_message">send_melanissimo_message</a></li><li><a href="global.html#send_with_francetransfert">send_with_francetransfert</a></li><li><a href="global.html#send_with_melanissimo">send_with_melanissimo</a></li><li><a href="global.html#serialize_recurrence">serialize_recurrence</a></li><li><a href="global.html#set_recurrence_edit">set_recurrence_edit</a></li><li><a href="global.html#set_title">set_title</a></li><li><a href="global.html#set_toolbar_item_valid">set_toolbar_item_valid</a></li><li><a href="global.html#settings_da_set_email_recup">settings_da_set_email_recup</a></li><li><a href="global.html#setup_calendar">setup_calendar</a></li><li><a href="global.html#show_header_row">show_header_row</a></li><li><a href="global.html#show_password_change">show_password_change</a></li><li><a href="global.html#show_rcube_manage_labels">show_rcube_manage_labels</a></li><li><a href="global.html#snooze_dropdown">snooze_dropdown</a></li><li><a href="global.html#startX">startX</a></li><li><a href="global.html#stockage">stockage</a></li><li><a href="global.html#tasklist_options_menu">tasklist_options_menu</a></li><li><a href="global.html#text2html">text2html</a></li><li><a href="global.html#text_color">text_color</a></li><li><a href="global.html#toHex">toHex</a></li><li><a href="global.html#treeMgr">treeMgr</a></li><li><a href="global.html#trigger">trigger</a></li><li><a href="global.html#unlock_saving">unlock_saving</a></li><li><a href="global.html#use_signature">use_signature</a></li><li><a href="global.html#validate_message">validate_message</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#visualValueCount">visualValueCount</a></li><li><a href="global.html#wait">wait</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Thu Mar 07 2024 16:46:19 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
