<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mel_useful_link/js/classes.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mel_useful_link/js/classes.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Récupère la popup et permet de la manipuler.
 * @returns {LinkPopUp}
 */
 function GetLinkPopUp()
 {
     if (GetLinkPopUp.popup === undefined)
         GetLinkPopUp.popup = new LinkPopUp();
 
     return GetLinkPopUp.popup;
 }
 
 class LinkPopUp
 {
     constructor()
     {
         let config = new GlobalModalConfig();
         config.title = "Chargement...";
         config.content = `&lt;center>&lt;span class="spinner-grow">&lt;span class="sr-only">Chargement....&lt;/span>&lt;/span>&lt;/center>`;
         config.footer = "";
         this.modal = new GlobalModal("globalModal", config);
     }
 
     setTitle(string)
     {
         this.modal.editTitle(string);
     }
 
     setBody(string)
     {
         this.modal.editBody(string);
     }
 
     setLoading()
     {
         this.setTitle("Chargement...");
         this.setBody(`&lt;center>&lt;span class="spinner-grow">&lt;span class="sr-only">Chargement....&lt;/span>&lt;/span>&lt;/center>`);
         this.modal.footer.querry.html("")
     }
 
     /**
      * 
      * @param {MelLink|null} link 
      * @returns {LinkPopUp}
      */
     setLinkEditor(link = null, task = "useful_links", action = "update", addonConfig= null, afterCreate = null)
     {
         if (link === null) link = new MelLink();
             
         this.setTitle(link.id === "" ? "Création d'un nouveau lien" : "Modification d'un lien");
 
         if (this.modal.contents.find("#mul-editor2").length > 0) this.modal.contents.find("#mul-editor2").remove();

         if (this.modal.contents.find("#mul-editor").length === 0)
         {
             const isSubLink = link.isSubLink();
             const isPersonal = link.personal;
             const redstar = '&lt;span style=color:red>*&lt;/span> ';
             let parentDiv = $(`&lt;div id="mul-editor">${redstar}Champs obligatoires&lt;/div>`);
 
             /**Id */
             $(`&lt;input type="hidden" id="mulc-id" value="${link.id}" />`).appendTo(parentDiv);
             /**subItem */
             $(`&lt;input type="hidden" id="mulc-subItem" value="${isSubLink}" />`).appendTo(parentDiv);

             if (isSubLink)
             {
                /**Sub Id */
                $(`&lt;input type="hidden" id="mulc-subid" value="${link.subItem.id}" />`).appendTo(parentDiv);
                /**SubParent */
                $(`&lt;input type="hidden" id="mulc-subparent" value="${link.subItem.parentId}" />`).appendTo(parentDiv);
             }
 
             /**Title */
             this.linkText("mulc-title", "Nom du lien", "Titre du lien", link.title, true, (!isPersonal ? {disabled:'disabled'} : null)).appendTo(parentDiv);
 
             /**Url */
             this.linkText("mulc-url", "Adresse de la page", "URL", link.link, false, (!isPersonal ? {disabled:'disabled'} : null)).appendTo(parentDiv);

             /**Couleur */
             this.linkColor("mulc-color", "Couleur de la vignette", link.color, link.textColor).appendTo(parentDiv);
         
             /**Show When */
             //this.linkChoice("mulc-sw", "Choisissez quand le lien doit être visible", 0, {value:"always", text:"Tout le temps"}, {value:"internet", text:"Depuis internet"}, {value:"intranet", text:"Depuis l'intranet"}).appendTo(parentDiv);
 
             this.setBody("");
             this.modal.appendToBody(parentDiv);
 
             this.modal.footer.querry.html("").append($(`&lt;button id="mulc-button" class="mel-button btn btn-secondary">${link.id === "" ? 'Ajouter&lt;span class="plus icon-mel-plus">&lt;/span>' : 'Modifier&lt;span class="plus icon-mel-pencil">&lt;/span>'}&lt;/button>`).on("click", () => {
                 event.preventDefault();
 
                 if (!$("#mulc-title")[0].reportValidity())
                     return;
                 if (!$("#mulc-url")[0].reportValidity())
                     return;

                 const link = new MelLink($("#mulc-id").val(), $("#mulc-title").val(), $("#mulc-url").val(), "always", "always",  false,($("#mulc-subItem").val() == "true" ? new MelSubLink($("#mulc-subid").val(), $("#mulc-subparent").val()) : null), $("#mulc-color").val()/*$("#mulc-sw").val()*/, isPersonal, $("#mulc-color-text").val());//.callUpdate().then(() => this.hide());
                 this.setLoading();

                 link.callUpdate(task, action, addonConfig).then((result) => {
                    if (afterCreate !== null)
                        afterCreate(result, link);
                    else {

                      if (result === true)
                          window.location.reload();
                      else
                          this.setLinkEditor(link);
                    }
 
                 });
             }));
         }
         else
         {
            $("#mulc-color").val(link.color);
             $("#mulc-id").val(link.id);
             $("#mulc-title").val(link.title);
             $("#mulc-url").val(link.link);
             $("#mulc-subItem").val(link.isSubLink());
             $("#mulc-subid").val(link.subItem.id);
             $("#mulc-subparent").val(link.subItem.parentId);
             $("#mulc-sw").val(link.showWhen === "" ? "always" : link.showWhen);
             $("#mulc-button").html(link.id === "" ? 'Ajouter&lt;span class="plus icon-mel-plus">&lt;/span>' : 'Modifier&lt;span class="plus icon-mel-pencil">&lt;/span>');
         }
 
         return this;
     }

     setMultiLinkEditor(link = null, task = "useful_links", action = "update", addonConfig= null, afterCreate = null)
     {
        if (link === null) link = new MelMultiLink();

        this.setTitle(link.id === "" ? "Création d'un nouveau multi-lien" : "Modification d'un multi-lien");

        if (this.modal.contents.find("#mul-editor2").length > 0) this.modal.contents.find("#mul-editor2").remove();
        if (this.modal.contents.find("#mul-editor").length > 0) this.modal.contents.find("#mul-editor").remove();

        if (this.modal.contents.find("#mul-editor2").length === 0)
        {
            const isSubLink = link.isSubLink();
            const isPersonal = link.personal;
            const redstar = '&lt;span style=color:red>*&lt;/span> ';
            let it = 1;
            let parentDiv = $(`&lt;div id="mul-editor2">${redstar}Champs obligatoires&lt;/div>`);
            /**Id */
            $(`&lt;input type="hidden" id="mulc-id" value="${link.id}" />`).appendTo(parentDiv);
            /**subItem */
            $(`&lt;input type="hidden" id="mulc-subItem" value="${isSubLink}" />`).appendTo(parentDiv);

            if (isSubLink)
            {
                /**Sub Id */
                $(`&lt;input type="hidden" id="mulc-subid" value="${link.subItem.id}" />`).appendTo(parentDiv);
                /**SubParent */
                $(`&lt;input type="hidden" id="mulc-subparent" value="${link.subItem.parentId}" />`).appendTo(parentDiv);
            }
            /**Title */
            this.linkText("mulc-title", "Nom de la vignette", "Titre de la vignette", link.title, true, (!isPersonal ? {disabled:'disabled'} : null)).appendTo(parentDiv);

            /**Couleur */
            this.linkColor("mulc-color", "Couleur de la vignette", link.color, link.textColor).appendTo(parentDiv);

            let button = $('&lt;button class="btn btn-secondary mel-button no-button-margin">Ajouter un lien &lt;span class="plus icon-mel-plus">&lt;/span>&lt;/button>')
            .click(() => {
                const valit = it;
                const val =  Enumerable.from(link.links).insert(0, [null]).toArray()[it] ?? {
                    key:'',
                    value:''
                };
                /**Title */
                this.linkText(`mulc-title-${it}`, `Nom du lien N°${it}`, `Titre du lien N°${it}`, val.value, true, (!isPersonal ? {disabled:'disabled'} : null)).appendTo(divLinks);
                if (it !== 1)
                {
                    $(`label[for="mulc-title-${it}"]`).append($(`&lt;button class='btn btn-danger mel-button no-button-margin' style="float:right">Supprimer&lt;/button>`).click(() => {
                        $(`#mulc-title-${valit}`).remove();
                        $(`label[for="mulc-title-${valit}"]`).remove();
                        $(`#mulc-url-${valit}`).remove();
                        $(`label[for="mulc-url-${valit}"]`).remove();
                        $(`#separate-${valit}`).remove();

                        let comp = 0;
                        for (let index = 1; index &lt; it; ++index) {
                            if ($(`#mulc-title-${index}`).length === 0)
                            {
                                ++comp;
                            }
                            else {
                                if (comp > 0)
                                {
                                    $(`#mulc-title-${index}`).attr('id', `mulc-title-${index-comp}`);
                                    $(`label[for="mulc-title-${index}"]`).attr('for', `mulc-title-${index-comp}`).find('.title-label-text').html(`Nom du lien N°${index-comp}`);
                                    $(`#mulc-url-${index}`).attr('id', `mulc-url-${index-comp}`);
                                    $(`label[for="mulc-url-${index}"]`).attr('for', `mulc-url-${index-comp}`).find('.title-label-text').html(`Adresse du lien N°${index-comp}`);
                                    $(`#separate-${index}`).attr('id', `separate-${index-comp}`);
                                }
                            }
                            
                        }
                    }));
                }
                /**Url */
                this.linkText(`mulc-url-${it}`, `Adresse du lien N°${it}`, "URL", val.key, false, (!isPersonal ? {disabled:'disabled'} : null)).appendTo(divLinks);
                $(`&lt;separate id="separate-${it}">&lt;/separate>`).css('margin', 0).css('margin-top', '15px').appendTo(divLinks);
                ++it;
            }).css('margin-top', '15px');
            button.appendTo(parentDiv);

            let divLinks = $('&lt;div>&lt;/div>').appendTo(parentDiv);

            this.setBody("");
            this.modal.appendToBody(parentDiv);

            if (link.links.length === 0) button.click();
            else {
                for (const key in link.links) {
                    if (Object.hasOwnProperty.call(link.links, key)) {
                        const element = link.links[key];
                        button.click();
                    }
                }
            }

            this.modal.footer.querry.html("").append($(`&lt;button id="mulc-button" class="mel-button btn btn-secondary">${link.id === "" ? 'Ajouter&lt;span class="plus icon-mel-plus">&lt;/span>' : 'Modifier&lt;span class="plus icon-mel-pencil">&lt;/span>'}&lt;/button>`).on("click", () => {
                event.preventDefault();
                if (!$("#mulc-title")[0].reportValidity())
                    return;
                let link = new MelMultiLink($("#mulc-id").val(), $("#mulc-title").val(), '', "always", "always",  false,($("#mulc-subItem").val() == "true" ? new MelSubLink($("#mulc-subid").val(), $("#mulc-subparent").val()) : null), $("#mulc-color").val()/*$("#mulc-sw").val()*/, isPersonal, $("#mulc-color-text").val());

                for (let index = 1;  $(`#mulc-title-${index}`).length > 0; ++index) {
                    if (!$(`#mulc-url-${index}`)[0].reportValidity()) return;
                    if (!$(`#mulc-title-${index}`)[0].reportValidity()) return;
                    link.addLink($(`#mulc-url-${index}`).val(), $(`#mulc-title-${index}`).val());
                }

                this.setLoading();

                link.callUpdate(task, action, addonConfig).then((result) => {
                   if (afterCreate !== null)
                       afterCreate(result, link);
                   else {

                     if (result === true)
                         window.location.reload();
                     else
                         this.setMultiLinkEditor(link);
                   }

                });
            }));
        }

        return this;
     }
 
     /**
      * 
      * @param {MelLink} link 
      */
     setPopUpChoice(link)
     {
        if (!link.personal) {
            ModifyLink(link);
            return this;
        }

         this.setTitle(`Que souhaitez-vous faire du lien "${this.setLinkMaxSize(link.title)}"`);
         let html = '&lt;div style="display:flex">';
 
         //console.log(link);
 
         for (let index = 0; index &lt; rcmail.env.link_modify_options.length; ++index) {
             const element = rcmail.env.link_modify_options[index];
             html += `&lt;button style="margin-top:0px;margin-right:15px" onclick="${element.action}(MelLink.from('${link.id}'))" class="btn btn-block btn-secondary btn-mel">&lt;span class="block ${element.icon}">&lt;/span>${rcmail.gettext(element.name, "mel_useful_link")}&lt;/button>`;
         }
 
         html += "&lt;/div>";
         this.setBody(html);
         this.modal.footer.querry.html("");
 
         return this;
     }

     drawChoice(title, ...choices)
     {
        this.setTitle(title);

        let html = $('&lt;div style="display:flex;">&lt;/div>');
        for (const key in choices) {
            if (Object.hasOwnProperty.call(choices, key)) {
                const element = choices[key];
                html.append($(`
                &lt;button style="margin-top:0px;margin-right:15px" class="btn btn-block btn-secondary btn-mel">&lt;span class="block ${element.icon}">&lt;/span>${rcmail.gettext(element.name, "mel_useful_link")}&lt;/button>
                `).click(element.click));
            }
        }

        this.setBody(html);
        this.modal.footer.querry.html("");
 
        return this;
     }
 
     /**
      * Troncate un texte trop grand.
      * @param {string} txt 
      * @param {number} max 
      * @returns {string}
      */
     setLinkMaxSize(txt, max = 40)
     {
         if (txt.length > max)
             txt = txt.slice(0, max-3) + "...";
         
         return txt;
     }
 
     linkText(id, title, placeholder, value, isFirst = false, attrib = null)
     {
         const redstar = '&lt;span style=color:red>*&lt;/span> '
         let $label = $(`&lt;label for="${id}" class="span-mel t1 ${isFirst ? "first" : ""}">&lt;span class="title-label-text">${title}&lt;/span>${redstar}&lt;/label>`);
         let $input = $(`&lt;input id="${id}" class="form-control input-mel required" required type="text" placeholder="${placeholder}" value="${value}" />`);

         if (!!attrib)
         {
            for (const key in attrib) {
                if (Object.hasOwnProperty.call(attrib, key)) {
                    const element = attrib[key];
                    $input.attr(key, element);
                }
            }
         }

         return $label.add($input);
     }

     linkColor(id, title, value, textValue = '#363A5B', attrib = null)
     {
        let $input = $(`&lt;div>&lt;label for="${id}" class="span-mel t1">${title}&lt;/label>&lt;input title="Couleur de la vignette" style="max-width:50px;display:inline-block" id="${id}" class="link-color-before form-control input-mel required" required type="color" value="${value}" />&lt;span style="background-color:${value}" class=link-test-color>Test couleur | &lt;a  href="#" onclick=event.preventDefault();>Test lien&lt;/a>&lt;/span>&lt;/div>`)
        .find("input").on("input", (e) => {
            $(e.currentTarget).parent().find(".link-test-color").css("background-color", $(e.currentTarget).val());
        });

        let $textColorInput = $(`&lt;input title="Couleur du texte" style="max-width:50px;display:inline-block" id="${id}-text" class="link-color-before form-control input-mel required" required type="color" value="${textValue}" />`).on('input',(e) => {
            $(e.currentTarget).parent().find(".link-test-color")[0].style.setProperty('color', $(e.currentTarget).val(), 'important');//.css("color", $(e.currentTarget).val()+'!important');
        });

        $input.parent().find('.link-test-color')[0].style.setProperty('color', textValue, 'important');

        $input.after($textColorInput);

        if (!!attrib) 
        {
            for (const key in attrib) {
                if (Object.hasOwnProperty.call(attrib, key)) {
                    const element = attrib[key];
                    $input.attr(key, element);
                }
            }
        }

        return $input.parent();
     }
 
     linkChoice(id, title, _default = 0, ...choices)
     {
         let options = "";
         for (let index = 0; index &lt; choices.length; ++index) {
             const element = choices[index];
             options += `&lt;option ${index === _default ? "selected" : ""} value="${element.value}">${element.text}&lt;/option>`;
         }
 
         return $(`&lt;label for="${id}" class="span-mel t1 first">${title}&lt;/label>&lt;select id="${id}" class="form-control input-mel custom-select pretty-select">${options}&lt;/select>`);
     }
 
     show()
     {
         this.modal.show();
     }
 
     hide()
     {
         this.modal.close();
     }
 }
 
 class MelLink
 {
     constructor(...args)
     {
         this.setup();
 
         if (args.length > 0)
             this.init(...args);
     }
 
     find()
     {
         return $(`#link-block-${this.id}`);
     }
 
     setup()
     {
         this.id = "";
         this.title = "";
         this.link = "";
         this.from = "";
         this.showWhen = "";
         this.subItem = null;
         this.hidden = false;
         this.color = "#F0F0F0";
         this.textColor= '#363A5b';
         this.personal = true;
     }
 
     init(id, title, link, from, showWhen, hidden, subItem = null, color = "#F0F0F0", personal = true, textColor = '#363A5b')
     {
         this.id = id;
         this.title = title;
         this.link = link;
         this.from = from;
         this.showWhen = showWhen;
         this.hidden = hidden;
         this.subItem = subItem;
         this.personal = personal;

         if (color !== undefined &amp;&amp; color !== null &amp;&amp; color != "") this.color = color;

         this.textColor = textColor || this.textColor;
     }

     isSubLink()
     {
         return this.subItem !== null;
     }
 
     delete(popup = null)
     {
         if (popup === null)
             popup = ModifyLink.popup;
         
         if (popup !== null)
             popup.setLoading();
         
         rcmail.setBusy(true, "loading");
 
         return this.callDelete().always(() => {
             popup.hide();
             if (rmail.busy)
             {
                 rcmail.setBusy(false);
                 rcmail.clear_messages();
             }
          });
     }

     async callHideOrShow(task = "useful_links", action="hideOrShow", addonConfig = null)
     {
        rcmail.set_busy(true, "loading");

        let ok = false;
        let config = {
            _id:this.id,
            _is_sub_item:this.isSubLink()
        }

        if (config._is_sub_item)
            config = this.subItem.updateConfig(config);

        config = this.getConfig(config, addonConfig);

        //Call
        await mel_metapage.Functions.post(mel_metapage.Functions.url(task, action),
        config,
        (data) => {
            ok = true;
        }
        );
        //Si réussi
        if (ok)
        {
            if (rcmail.env.link_show_hiddened === undefined)
                rcmail.env.link_show_hiddened = false;
            
            //MAJ des liens
            ok = await this.callUpdateLinks(task, rcmail.env.showHiddenLinks);
        }

        rcmail.set_busy(false);
        rcmail.clear_messages();

        // if (!ok)
        //     rcmail.display_message("Une erreur est survenue lors de cette action !", "error");

     }

     async callUpdateLinks(task = "useful_links", showHiddened = false)
     {
        let ok = false;

        await mel_metapage.Functions.post(
            mel_metapage.Functions.url(task, "get_joined_links"),
            {_show:showHiddened}, 
            (datas) => {
                $(".body .joined .links-items").html(datas);
            }
        );

        return false;
     }

     static updateLinks(task = "useful_links", showHiddened = false)
     {
        return new MelLink().callUpdateLinks(task, showHiddened);
     }
 
     callDelete(task = "useful_links", action = "delete", addonConfig = null)
     {
         rcmail.set_busy(true, "loading");
 
         return mel_metapage.Functions.post(mel_metapage.Functions.url(task, action),
         this.getConfig({_id:this.id}, addonConfig),
         (datas) => {
            rcmail.set_busy(false);
            rcmail.clear_messages();
            rcmail.display_message("Suppression effectué avec succès !", "confirmation");
            this.find().remove();
         }
         ).done(() => {
             MelLink.refresh("joined");
             MelLink.refresh("epingle");
         });
     }
 
     getConfig(config, addonConfig = null)
     {
         if (addonConfig !== null)
         {
             for (const key in addonConfig) {
                 if (Object.hasOwnProperty.call(addonConfig, key)) {
                     const element = addonConfig[key];
                     
                     config[key] = element; 
                 }
             }
         }
 
         return config;
     }
 
     async callPin(task = "useful_links", action = "tak", addonConfig = null)
     {
        rcmail.set_busy(true, "loading");
        if (!this.personal)
        {
            return await this.callNoPersonalAction('pin', null, task);
        }

        let resultDatas = true;
        let config = {
            _id:this.id,
            _is_sub_item:this.isSubLink()
        }

        await mel_metapage.Functions.post(mel_metapage.Functions.url(task, action),
        this.getConfig(config, addonConfig),
        (datas) => {

        if (datas === "override")
        {
            resultDatas = datas;
            return;
        }

        rcmail.set_busy(false);
        rcmail.clear_messages();
        rcmail.display_message("Modification effectué avec succès !", "confirmation");
        }
        );

        if (resultDatas === "override"/* &amp;&amp; confirm("Il s'agit d'un lien personnel venant de l'ancien bureau numérique, si vous continuez, il sera supprimé de l'ancien bureau numérique.\r\nÊtes-vous sûr de vouloir continuer ?")*/)
        {

            config["_forced"] = true;
            if (config._is_sub_item)
            {
                config = this.subItem.updateConfig(config);
                config["_subtitle"] = this.title;
            }

            await mel_metapage.Functions.post(mel_metapage.Functions.url(task, action),
            this.getConfig(config, addonConfig),
                (datas) => { 
                    rcmail.set_busy(false);
                    rcmail.clear_messages();
                    rcmail.display_message("Modification effectué avec succès !", "confirmation");
                }
            );
        }
        else
        {
            rcmail.set_busy(false);
            rcmail.clear_messages();
        }
     }
 
     async callNoPersonalAction(action, datas, task = "useful_links")
     {
        let config = {
            _id:this.id
        };

        
        if (this.isSubLink()) config['_sub_id'] = this.subItem.id;

        switch (action) {
            case 'pin':
                action = 'tak_default';
                break;

            case 'updateColor':
                action = 'update_default_color';
                config['_color'] = datas;
                break;
        
            default:
                break;
        }

        await mel_metapage.Functions.post(mel_metapage.Functions.url(task, action),
        config,
            (datas) => { 
                rcmail.set_busy(false);
                rcmail.clear_messages();
                rcmail.display_message("Modification effectué avec succès !", "confirmation");
            }
        );
     }

     async callUpdate(task = "useful_links", action = "update", addonConfig = null)
     {
         rcmail.set_busy(true, "loading");
         if (!this.personal)
         {
             await this.callNoPersonalAction('updateColor', (this.color === "#F0F0F0" ? null : this.color), task);
             return true;
         }
         const notBusy = () => {
             rcmail.set_busy(false);
             rcmail.clear_messages();
         };
 
         const override = "override";
         const ok = true;
 
         let code;
         let success = true;
         let config = {
             _id:this.id,
             _title:this.title,
             _link:this.link,
             _from:this.from,
             _sw:this.showWhen,
             _is_sub_item:this.isSubLink(),
             _color:(this.color === "#F0F0F0" ? null : this.color),
             _text_color:(this.color === "#F0F0F0" &amp;&amp; this.textColor === '#363A5b' ? null : this.textColor)
         };
 
         if (config._is_sub_item)
            config  = this.subItem.updateConfig(config);

         config = this.getConfig(config, addonConfig);

         await mel_metapage.Functions.post(mel_metapage.Functions.url(task, action), config, (datas) => {
             code = datas;
         }, (a,b,c) => {
             success = false;
             notBusy();
             rcmail.display_message("Impossible d'ajouter ou de modifier ce lien.", "error");
             console.error(a,b,c);
         });
 
         if (code === override)
         {
            config["_force"] = true;
            config["_subtitle"] = this.title;
            await mel_metapage.Functions.post(mel_metapage.Functions.url(task, action), config, (datas) => {
                if (datas === override)
                {
                    notBusy();
                    success = false;
                    rcmail.display_message("Une erreur est survenue !", "error");
                    console.error(datas, this, config);
                }
            }, (a,b,c) => {
                notBusy();
                success = false;
                rcmail.display_message("Impossible d'ajouter ou de modifier ce lien.", "error");
                console.error(a,b,c);
            });
         }
 
         if (rcmail.busy)
             notBusy();
 
         return success;
 
     }
 
     static refresh(_class)
     {
         let next = false;
         let last = null;
         $(`.${_class} .col-md-6`).each((i, e) => {
             e = $(e);
             if (!next &amp;&amp; e.html() === "")
             {
                 next = true;
                 last = e;
             }
             else if (next &amp;&amp; last !== null)
             {
                 e.find("div").first().appendTo(last);
                 last = e;
             }
         });
 
         $(`.${_class} .row`).each((i, e) => {
             let it = 0;
             $(e).find(".col-md-6").each((it, col) => {
                 if ($(col).html === "")
                     ++it;
             });
             if (it === 2)
                 $(e).remove();
         });
     }
 
    static from(id)
    {
        id = $(`#link-block-${id}`);

        const isSubItem = id.data("subitem");

        let subLink = null;
        if (isSubItem) subLink = new MelSubLink(id.data("subid"), id.data("subparent"));

        let link = new MelLink(id.data("id"), id.data("title"), id.data("link"), id.data("from"), id.data("showWhen"), id.data("hidden"), subLink, id.data("color"), id.data('personal'), id.data("textcolor"));
        if ((id.data("links") || false) !== false)
        {
            link = MelMultiLink.fromLink(link);
            link.links = {};
            const raw = id.data("links");
            const datas = typeof raw === 'string' ? JSON.parse(raw.replace(/¤/g, '"')) : {};

            for (const key in datas) {
                if (Object.hasOwnProperty.call(datas, key)) {
                    const element = datas[key];
                    link.addLink(key, element);
                }
            }
        }

        return link;
    }
 
 }

 class MelMultiLink extends MelLink {
    constructor(...args)
    {
        super(...args);
    }

    setup()
    {
        super.setup();
        this.links = {};
    }

    addLink(link, title) {
        this.links[link] = title;
        this.link = JSON.stringify(this.links);
    }

    toLink() {
        let link = Object.assign(new MelLink(), this);
        link.links = undefined;
        link.link = this.links[0] ?? '';
        return link;
    }

    static fromLink(link)
    {
        link = Object.assign(new MelMultiLink(), link);
        const tmpLink = link.link;
        link.addLink(tmpLink, link.title);
        return link;
    }
 }

 class MelSubLink
 {
     constructor(id, parentId)
     {
        this.id = id;
        this.parentId = parentId;
     }

     updateConfig(config)
     {
        config["_subparent"] = this.parentId;
        config["_subid"] = this.id;
        return config;
     }
 }</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="OCA.Bnum.html">Bnum</a></li><li><a href="OCA.Bnum.App.html">App</a></li><li><a href="animation.html">animation</a></li><li><a href="aria.html">aria</a></li></ul><h3>Classes</h3><ul><li><a href="AMelScreenManager.html">AMelScreenManager</a></li><li><a href="Alarm.html">Alarm</a></li><li><a href="AlarmData.html">AlarmData</a></li><li><a href="AlarmPart.html">AlarmPart</a></li><li><a href="AudioVisualizer.html">AudioVisualizer</a></li><li><a href="BnumConnector.html">BnumConnector</a></li><li><a href="CalendarEvent.html">CalendarEvent</a></li><li><a href="CalendarLoader.html">CalendarLoader</a></li><li><a href="Calendar_Alarm.html">Calendar_Alarm</a></li><li><a href="CategoryData.html">CategoryData</a></li><li><a href="CategoryPart.html">CategoryPart</a></li><li><a href="ChatManager.html">ChatManager</a></li><li><a href="Color.html">Color</a></li><li><a href="ColorRGBA.html">ColorRGBA</a></li><li><a href="Connector.html">Connector</a></li><li><a href="EventField.html">EventField</a></li><li><a href="EventListenerDatas.html">EventListenerDatas</a></li><li><a href="EventManager.html">EventManager</a></li><li><a href="EventParts.html">EventParts</a></li><li><a href="EventView.html">EventView</a></li><li><a href="FreeBusyGuests.html">FreeBusyGuests</a></li><li><a href="GlobalModal.html">GlobalModal</a></li><li><a href="GlobalModalConfig.html">GlobalModalConfig</a></li><li><a href="GuestsPart_GuestsPart.html">GuestsPart</a></li><li><a href="IExt.html">IExt</a></li><li><a href="IntegratedVisio.html">IntegratedVisio</a></li><li><a href="InternalWebconfScreenManager.html">InternalWebconfScreenManager</a></li><li><a href="ListenerWebConfBar.html">ListenerWebConfBar</a></li><li><a href="MasterWebconfBar.html">MasterWebconfBar</a></li><li><a href="MasterWebconfBarItem.html">MasterWebconfBarItem</a></li><li><a href="MasterWebconfBarPopup.html">MasterWebconfBarPopup</a></li><li><a href="MelAudioManager.html">MelAudioManager</a></li><li><a href="MelAudioStruct.html">MelAudioStruct</a></li><li><a href="MelDataStore.html">MelDataStore</a></li><li><a href="MelIconPrevisualiser.html">MelIconPrevisualiser</a></li><li><a href="MelListingPrevisualiser.html">MelListingPrevisualiser</a></li><li><a href="MelNews.html">MelNews</a></li><li><a href="MelObject.html">MelObject</a></li><li><a href="MelPrevisualiser.html">MelPrevisualiser</a></li><li><a href="Mel_Promise.html">Mel_Promise</a></li><li><a href="MetapageModule.html">MetapageModule</a></li><li><a href="NewsPopup.html">NewsPopup</a></li><li><a href="Nextcloud_Document.html">Nextcloud_Document</a></li><li><a href="Nextcloud_Document_Config.html">Nextcloud_Document_Config</a></li><li><a href="Nextcloud_File.html">Nextcloud_File</a></li><li><a href="Nextcloud_Icon.html">Nextcloud_Icon</a></li><li><a href="Nextcloud_Response.html">Nextcloud_Response</a></li><li><a href="NotifierObject.html">NotifierObject</a></li><li><a href="OCA.Bnum.FileList.html">FileList</a></li><li><a href="ParapheurAction.html">ParapheurAction</a></li><li><a href="ParapheurMailAction.html">ParapheurMailAction</a></li><li><a href="RcmailDialog.html">RcmailDialog</a></li><li><a href="RcmailDialogButton.html">RcmailDialogButton</a></li><li><a href="RcmailDialogChoiceButton.html">RcmailDialogChoiceButton</a></li><li><a href="RightPannel.html">RightPannel</a></li><li><a href="RotomecaEnumerable.html">RotomecaEnumerable</a></li><li><a href="SearchResult.html">SearchResult</a></li><li><a href="SearchResultCalendar.html">SearchResultCalendar</a></li><li><a href="Slot.html">Slot</a></li><li><a href="Slots.html">Slots</a></li><li><a href="SplittedDate.html">SplittedDate</a></li><li><a href="Sticker.html">Sticker</a></li><li><a href="Title.html">Title</a></li><li><a href="VisioManager.html">VisioManager</a></li><li><a href="VisualiserObject.html">VisualiserObject</a></li><li><a href="VisualiserObjectEx_VisualiserObjectEx.html">VisualiserObjectEx</a></li><li><a href="WarningPanel.html">WarningPanel</a></li><li><a href="Webconf.html">Webconf</a></li><li><a href="WebconfChat.html">WebconfChat</a></li><li><a href="WebconfPageCreator.html">WebconfPageCreator</a></li><li><a href="WebconfScreenManager.html">WebconfScreenManager</a></li><li><a href="WebconfWorkspaceManager.html">WebconfWorkspaceManager</a></li><li><a href="aria.Dialog.html">Dialog</a></li><li><a href="html_events.html">html_events</a></li><li><a href="html_li.html">html_li</a></li><li><a href="html_ul.html">html_ul</a></li><li><a href="mail_html_mail_html.html">mail_html</a></li><li><a href="mel_cancellable_html_timer.html">mel_cancellable_html_timer</a></li><li><a href="mel_filter.html">mel_filter</a></li><li><a href="mel_html.html">mel_html</a></li><li><a href="mel_html2.html">mel_html2</a></li><li><a href="mel_html_timer.html">mel_html_timer</a></li><li><a href="rcube_splitter.html">rcube_splitter</a></li><li><a href="search.html">search</a></li><li><a href="searchBlock.html">searchBlock</a></li></ul><h3>Events</h3><ul><li><a href="AlarmPart.html#event:onChange">onChange</a></li><li><a href="CategoryPart.html#event:onChange">onChange</a></li><li><a href="EventView.html#event:before_save">before_save</a></li><li><a href="EventView.html#event:on_dialog_before_close">on_dialog_before_close</a></li><li><a href="EventView.html#event:on_drop">on_drop</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Cette">Cette</a></li><li><a href="global.html#DAY_MS">DAY_MS</a></li><li><a href="global.html#DeleteLink">DeleteLink</a></li><li><a href="global.html#End">End</a></li><li><a href="global.html#Enum%25C3%25A9ration">Enumération</a></li><li><a href="global.html#GetLinkPopUp">GetLinkPopUp</a></li><li><a href="global.html#HOUR_MS">HOUR_MS</a></li><li><a href="global.html#Middle">Middle</a></li><li><a href="global.html#Mode">Mode</a></li><li><a href="global.html#Nextcloud">Nextcloud</a></li><li><a href="global.html#Nombres">Nombres</a></li><li><a href="global.html#PDFFindBar">PDFFindBar</a></li><li><a href="global.html#PDFFindController">PDFFindController</a></li><li><a href="global.html#Plugin">Plugin</a></li><li><a href="global.html#Portail">Portail</a></li><li><a href="global.html#RoundriveCreate">RoundriveCreate</a></li><li><a href="global.html#SELECTOR_CLASS_ROUND_CALENDAR">SELECTOR_CLASS_ROUND_CALENDAR</a></li><li><a href="global.html#Start">Start</a></li><li><a href="global.html#TextLayerBuilder">TextLayerBuilder</a></li><li><a href="global.html#Tri">Tri</a></li><li><a href="global.html#URL">URL</a></li><li><a href="global.html#Update">Update</a></li><li><a href="global.html#ViewHistory">ViewHistory</a></li><li><a href="global.html#WSPReady">WSPReady</a></li><li><a href="global.html#_on_mention_update">_on_mention_update</a></li><li><a href="global.html#add_mobile_class">add_mobile_class</a></li><li><a href="global.html#api_notifications">api_notifications</a></li><li><a href="global.html#audio_alarms">audio_alarms</a></li><li><a href="global.html#audiourltotest">audiourltotest</a></li><li><a href="global.html#base_color">base_color</a></li><li><a href="global.html#base_text_color">base_text_color</a></li><li><a href="global.html#changeType">changeType</a></li><li><a href="global.html#checkAllIdentities">checkAllIdentities</a></li><li><a href="global.html#checkOneIdentity">checkOneIdentity</a></li><li><a href="global.html#check_workspace_integrity">check_workspace_integrity</a></li><li><a href="global.html#command_parapheur">command_parapheur</a></li><li><a href="global.html#componentToHex">componentToHex</a></li><li><a href="global.html#copy_signature">copy_signature</a></li><li><a href="global.html#createImage">createImage</a></li><li><a href="global.html#createLogo">createLogo</a></li><li><a href="global.html#createLogoType">createLogoType</a></li><li><a href="global.html#current_desktop_notification">current_desktop_notification</a></li><li><a href="global.html#date2ISO8601">date2ISO8601</a></li><li><a href="global.html#date2unixtime">date2unixtime</a></li><li><a href="global.html#default_note_uid">default_note_uid</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#dialog">dialog</a></li><li><a href="global.html#dismiss_alarm">dismiss_alarm</a></li><li><a href="global.html#display_alarms">display_alarms</a></li><li><a href="global.html#docReady">docReady</a></li><li><a href="global.html#download">download</a></li><li><a href="global.html#download_signature_outlook_htm">download_signature_outlook_htm</a></li><li><a href="global.html#download_signature_outlook_zip">download_signature_outlook_zip</a></li><li><a href="global.html#download_signature_thunderbird">download_signature_thunderbird</a></li><li><a href="global.html#enum_tooltip_mode">enum_tooltip_mode</a></li><li><a href="global.html#enum_tooltip_position">enum_tooltip_position</a></li><li><a href="global.html#ev_calendar_url">ev_calendar_url</a></li><li><a href="global.html#event_date_text">event_date_text</a></li><li><a href="global.html#fluxhtml">fluxhtml</a></li><li><a href="global.html#fluxrss">fluxrss</a></li><li><a href="global.html#folder_collapse">folder_collapse</a></li><li><a href="global.html#folder_collapse_unified">folder_collapse_unified</a></li><li><a href="global.html#folder_count">folder_count</a></li><li><a href="global.html#folder_count_unified">folder_count_unified</a></li><li><a href="global.html#folder_expand">folder_expand</a></li><li><a href="global.html#formatPhoneNumber">formatPhoneNumber</a></li><li><a href="global.html#format_datetime">format_datetime</a></li><li><a href="global.html#format_time">format_time</a></li><li><a href="global.html#fromunixtime">fromunixtime</a></li><li><a href="global.html#generate_canvas">generate_canvas</a></li><li><a href="global.html#getOutputScale">getOutputScale</a></li><li><a href="global.html#getPDFFileNameFromURL">getPDFFileNameFromURL</a></li><li><a href="global.html#getSignatureHTML">getSignatureHTML</a></li><li><a href="global.html#get_organizer">get_organizer</a></li><li><a href="global.html#has_attendees">has_attendees</a></li><li><a href="global.html#has_permission">has_permission</a></li><li><a href="global.html#hide_header_row">hide_header_row</a></li><li><a href="global.html#init_recurrence_edit">init_recurrence_edit</a></li><li><a href="global.html#init_time_autocomplete">init_time_autocomplete</a></li><li><a href="global.html#isArrayLike">isArrayLike</a></li><li><a href="global.html#isAsync">isAsync</a></li><li><a href="global.html#isNullOrUndefined">isNullOrUndefined</a></li><li><a href="global.html#is_attendee">is_attendee</a></li><li><a href="global.html#is_internal_organizer">is_internal_organizer</a></li><li><a href="global.html#is_organizer">is_organizer</a></li><li><a href="global.html#libkolab_audittrail">libkolab_audittrail</a></li><li><a href="global.html#load_next_page">load_next_page</a></li><li><a href="global.html#loader">loader</a></li><li><a href="global.html#m_mp_Create">m_mp_Create</a></li><li><a href="global.html#m_mp_CreateDocumentIconContract">m_mp_CreateDocumentIconContract</a></li><li><a href="global.html#m_mp_CreateEvent">m_mp_CreateEvent</a></li><li><a href="global.html#m_mp_CreateEvent_inpage">m_mp_CreateEvent_inpage</a></li><li><a href="global.html#m_mp_CreateOrOpenFrame">m_mp_CreateOrOpenFrame</a></li><li><a href="global.html#m_mp_Help">m_mp_Help</a></li><li><a href="global.html#m_mp_InitializeDocument">m_mp_InitializeDocument</a></li><li><a href="global.html#m_mp_NotificationFilter">m_mp_NotificationFilter</a></li><li><a href="global.html#m_mp_NotificationGetDate">m_mp_NotificationGetDate</a></li><li><a href="global.html#m_mp_NotificationGetElement">m_mp_NotificationGetElement</a></li><li><a href="global.html#m_mp_NotificationProcess">m_mp_NotificationProcess</a></li><li><a href="global.html#m_mp_NotificationProcessAfterAction">m_mp_NotificationProcessAfterAction</a></li><li><a href="global.html#m_mp_NotificationRefresh">m_mp_NotificationRefresh</a></li><li><a href="global.html#m_mp_NotificationRun">m_mp_NotificationRun</a></li><li><a href="global.html#m_mp_NotificationSettings">m_mp_NotificationSettings</a></li><li><a href="global.html#m_mp_NotificationStartup">m_mp_NotificationStartup</a></li><li><a href="global.html#m_mp_NotificationsAction">m_mp_NotificationsAction</a></li><li><a href="global.html#m_mp_NotificationsAppendFilters">m_mp_NotificationsAppendFilters</a></li><li><a href="global.html#m_mp_NotificationsAppendToPanel">m_mp_NotificationsAppendToPanel</a></li><li><a href="global.html#m_mp_NotificationsClean">m_mp_NotificationsClean</a></li><li><a href="global.html#m_mp_NotificationsDelete">m_mp_NotificationsDelete</a></li><li><a href="global.html#m_mp_NotificationsGet">m_mp_NotificationsGet</a></li><li><a href="global.html#m_mp_NotificationsMerge">m_mp_NotificationsMerge</a></li><li><a href="global.html#m_mp_NotificationsRefreshUnread">m_mp_NotificationsRefreshUnread</a></li><li><a href="global.html#m_mp_NotificationsSet">m_mp_NotificationsSet</a></li><li><a href="global.html#m_mp_NotificationsShowUnread">m_mp_NotificationsShowUnread</a></li><li><a href="global.html#m_mp_NotificationsSort">m_mp_NotificationsSort</a></li><li><a href="global.html#m_mp_OpenTask">m_mp_OpenTask</a></li><li><a href="global.html#m_mp_RizomoRefreshNotifications">m_mp_RizomoRefreshNotifications</a></li><li><a href="global.html#m_mp_ShowDesktopNotification">m_mp_ShowDesktopNotification</a></li><li><a href="global.html#m_mp_ShowNotification">m_mp_ShowNotification</a></li><li><a href="global.html#m_mp_ToggleGroupOptionsUser">m_mp_ToggleGroupOptionsUser</a></li><li><a href="global.html#m_mp_UpdateCreateDoc">m_mp_UpdateCreateDoc</a></li><li><a href="global.html#m_mp_action_from_storage">m_mp_action_from_storage</a></li><li><a href="global.html#m_mp_anchor_ariane">m_mp_anchor_ariane</a></li><li><a href="global.html#m_mp_close_ariane">m_mp_close_ariane</a></li><li><a href="global.html#m_mp_full_screen_ariane">m_mp_full_screen_ariane</a></li><li><a href="global.html#m_mp_get_all_hashtag">m_mp_get_all_hashtag</a></li><li><a href="global.html#m_mp_help_video">m_mp_help_video</a></li><li><a href="global.html#m_mp_set_storage">m_mp_set_storage</a></li><li><a href="global.html#mel_metapage">mel_metapage</a></li><li><a href="global.html#mel_shortcuts_press">mel_shortcuts_press</a></li><li><a href="global.html#meteo">meteo</a></li><li><a href="global.html#mm_s_Action">mm_s_Action</a></li><li><a href="global.html#mm_s_AfficheResults">mm_s_AfficheResults</a></li><li><a href="global.html#mm_s_CreateOrUpdateFrame">mm_s_CreateOrUpdateFrame</a></li><li><a href="global.html#mm_s_OnClick">mm_s_OnClick</a></li><li><a href="global.html#mm_s_bodyClick">mm_s_bodyClick</a></li><li><a href="global.html#mm_s_extend">mm_s_extend</a></li><li><a href="global.html#modify_signature">modify_signature</a></li><li><a href="global.html#noContextMenuHandler">noContextMenuHandler</a></li><li><a href="global.html#onInputChange">onInputChange</a></li><li><a href="global.html#open_dialog">open_dialog</a></li><li><a href="global.html#parseISO8601">parseISO8601</a></li><li><a href="global.html#parse_datetime">parse_datetime</a></li><li><a href="global.html#plugin_text">plugin_text</a></li><li><a href="global.html#rcm_tb_label_insert">rcm_tb_label_insert</a></li><li><a href="global.html#rcm_tb_label_submenu">rcm_tb_label_submenu</a></li><li><a href="global.html#rcube_libcalendaring">rcube_libcalendaring</a></li><li><a href="global.html#rcube_mail_ui">rcube_mail_ui</a></li><li><a href="global.html#rcube_scroller">rcube_scroller</a></li><li><a href="global.html#rcube_tasklist">rcube_tasklist</a></li><li><a href="global.html#rcube_tasklist_ui">rcube_tasklist_ui</a></li><li><a href="global.html#rgbToHex">rgbToHex</a></li><li><a href="global.html#save_option">save_option</a></li><li><a href="global.html#saving_lock">saving_lock</a></li><li><a href="global.html#scrollIntoView">scrollIntoView</a></li><li><a href="global.html#send_francetransfert_message">send_francetransfert_message</a></li><li><a href="global.html#send_melanissimo_message">send_melanissimo_message</a></li><li><a href="global.html#send_with_francetransfert">send_with_francetransfert</a></li><li><a href="global.html#send_with_melanissimo">send_with_melanissimo</a></li><li><a href="global.html#serialize_recurrence">serialize_recurrence</a></li><li><a href="global.html#set_recurrence_edit">set_recurrence_edit</a></li><li><a href="global.html#set_title">set_title</a></li><li><a href="global.html#set_toolbar_item_valid">set_toolbar_item_valid</a></li><li><a href="global.html#settings_da_set_email_recup">settings_da_set_email_recup</a></li><li><a href="global.html#setup_calendar">setup_calendar</a></li><li><a href="global.html#show_header_row">show_header_row</a></li><li><a href="global.html#show_password_change">show_password_change</a></li><li><a href="global.html#show_rcube_manage_labels">show_rcube_manage_labels</a></li><li><a href="global.html#snooze_dropdown">snooze_dropdown</a></li><li><a href="global.html#startX">startX</a></li><li><a href="global.html#stockage">stockage</a></li><li><a href="global.html#tasklist_options_menu">tasklist_options_menu</a></li><li><a href="global.html#text2html">text2html</a></li><li><a href="global.html#text_color">text_color</a></li><li><a href="global.html#toHex">toHex</a></li><li><a href="global.html#unlock_saving">unlock_saving</a></li><li><a href="global.html#use_signature">use_signature</a></li><li><a href="global.html#validate_message">validate_message</a></li><li><a href="global.html#visualValueCount">visualValueCount</a></li><li><a href="global.html#wait">wait</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Mar 06 2024 17:26:58 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
