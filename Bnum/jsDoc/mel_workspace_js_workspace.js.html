<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mel_workspace/js/workspace.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mel_workspace/js/workspace.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>$(document).ready(async () => {
    initCloud();
    WSPReady().then(() => {
        function init_clicks()
        {
            for (const iterator of $('.click-tab')) {
                //récupération du namespace
    
                $(iterator).click((e) => {
                    const namespace = get_namespace(e.currentTarget);
                    const id = e.currentTarget.id;
                    e = $(e.currentTarget);
    
                    if (e.hasClass('selected'))
                    {
                        $(`.${namespace}.${id}`).addClass('hidden');
                        e.removeClass('selected').find('span.icon-mel-chevron-down').removeClass('icon-mel-chevron-down').addClass('icon-mel-chevron-right');
                    }
                    else {
                        $(`.${namespace}.${id}`).removeClass('hidden');
                        e.addClass('selected').find('span.icon-mel-chevron-right').removeClass('icon-mel-chevron-right').addClass('icon-mel-chevron-down');
                    }
                }); 
            }
        }
        
        function get_namespace(node)
        {
            return Enumerable.from(node.classList).where(x => x.includes('click') &amp;&amp; x !== 'click-tab').first();
        }
    
        init_clicks();
        //init_sondages();
        connect_sondage();
    
        window.init_clicks = window.init_clicks || init_clicks;
    });

});

/**
 * @async Fonction appelé lorsque la page de l'espace à fini son chargement.
 */
async function WSPReady()
{
    const uid = rcmail.env.current_workspace_uid;
    const hasAriane = $(".wsp-ariane").length > 0;

    let datas = mel_metapage.Storage.get(mel_metapage.Storage.ariane);
    let end = End(uid, hasAriane, datas);
    Start(uid, hasAriane, datas);
    Middle(uid, hasAriane, datas);
    return end.then(() => {
        WSPReady.started = moment();
    });
}

/**
 * Appelé par WSPReady, il s'agit de la première action, on fait ici les actions légères.
 * @param {string} uid Id de l'espace de travail
 * @param {boolean} hasAriane Si l'espace possède une discussion ou non.
 * @param {*} datas Diverses données
 */
function Start(uid, hasAriane, datas) {

    //SetupToolbar();

    //Gérer la barre de navigation
    const style = rcmail.env.current_bar_colors;
    let $html = $("html");

    if (true || !$html.hasClass("framed"))
        $html = $("#layout-content");

    if (!$html.hasClass("mwsp")) $html.addClass("mwsp");

    //Afficher/cacher la barre de navigation
    $(".wsp-toolbar-melw-wsp-hider").click(() => {
        const down = 'icon-mel-chevron-down';
        const up = 'icon-mel-chevron-up';
        let $children = $(".wsp-toolbar-melw-wsp-hider").children();

        if ($children.hasClass(down))
        {
            let $parent = $(".wsp-toolbar-melw-wsp-hider")
            .css("right", "0")
            .css("width", '100%')
            .attr("title", "Afficher la barre d'accès rapide")
            .parent();
            $parent.css('bottom', `-${$parent[0].clientHeight}px`);
            $children.removeClass(down)
            .addClass(up);
            $html.addClass("moved");
        }
        else {
            let $parent = $(".wsp-toolbar-melw-wsp-hider")
            .css("right", "")
            .css("width", '')
            .attr("title", "Cacher la barre d'accès rapide")
            .parent();
            $parent.css('bottom', '');
            $children.removeClass(up)
            .addClass(down);
            $html.removeClass("moved");
        }
    });

    $('#button-create-new-survey').click(() => {
        rcmail.command('workspace.survey.create');
    });

    if (!top.$("body").hasClass("task-workspace")) top.$(".mwsp-style").remove();
    
    if (style !== undefined &amp;&amp; style !== null &amp;&amp; style !== '') if (!top.$("body").hasClass("task-workspace")) top.$("body").prepend(`&lt;div class="mwsp-style">${style}&lt;/div>`);

    //Gérer la barre de navigation avec ariane
    if (top.wsp_cf_d !== true)
    {
        try {
            top.metapage_frames.addEvent("changepage.after", (eClass, changepage, isAriane, querry, id, actions)=> {
                if (changepage)
                {
                    if (eClass === "workspace")
                    {
                        let bool = querry[0].nodeName === 'IFRAME' ? querry[0].contentWindow.rcmail.env.action === 'workspace' : rcmail.env.action === 'workspace';

                        if (bool) $(".ariane-card").addClass("amwsp");
                        
                    }
                    else {
                        $(".ariane-card").removeClass("amwsp");
                    }

                }
            });

            top.$(".tiny-rocket-chat").click(async () => {
                //ariane-card
                let $ariane = $(".ariane-card");

                if ($ariane.length === 0) await wait(() => $(".ariane-card").length === 0);

                if (rcmail.env.current_frame_name === undefined) rcmail.env.current_frame_name = rcmail.env.task;

                if (rcmail.env.current_frame_name === "workspace")  $(".ariane-card").addClass("amwsp");
                else $(".ariane-card").removeClass("amwsp");

            });

        } catch (error) {
            console.error(error);
        }
        top.wsp_cf_d = true;
    }

    setup_wsp_colors();
    

    $(".wsp-copy-button").click(() => {
        const url = mel_metapage.Functions.url("workspace", "workspace", {_uid:rcmail.env.current_workspace_uid}).replace(`&amp;${rcmail.env.mel_metapage_const.key}=${rcmail.env.mel_metapage_const.value}`, '') + '&amp;_force_bnum=1';
        mel_metapage.Functions.copy(url);
    });
    
    const url = mel_metapage.Functions.url("workspace", "workspace", {_uid:rcmail.env.current_workspace_uid}) + '&amp;_force_bnum=1';
    (top ?? parent ?? window).history.replaceState({}, document.title, url.replace(`&amp;${rcmail.env.mel_metapage_const.key}=${rcmail.env.mel_metapage_const.value}`, ""));

    setup_end_date();
    rcmail.addEventListener("mail_wsp_updated", wsp_mail_updated);
    rcmail.env.nextcloudCopy = mel_metapage.Functions.url("workspace", "workspace", {
        _uid:uid
    }).replace(`&amp;${rcmail.env.mel_metapage_const.key}=${rcmail.env.mel_metapage_const.value}`, '');
    //A faire si webconf
    if (top.webconf_master_bar !== undefined)
    {
        top.webconf_master_bar.minify_toolbar();

        if (!$("html").hasClass("framed"))
            $(".wsp-toolbar.melw-wsp").addClass('webconfstarted');

    }
        
    //Stockage local
    mel_metapage.Storage.set("current_wsp", rcmail.env.current_workspace_uid)
    mel_metapage.Storage.set("current_wsp_mail", rcmail.env.current_workspace_email)

    rcmail.triggerEvent("mel_workspace.start", {
        uid,
        hasAriane, 
        datas
    });
}

/**
 * Appelé par WSPReady, on fait les actions après le Start, les actions sont légère ou moyenement légères.
 * @param {string} uid Id de l'espace de travail
 * @param {boolean} hasAriane Si l'espace possède une discussion ou non.
 * @param {*} datas Diverses données
 */
function Middle(uid, hasAriane, datas) {

    SetCalendarDate();

    try {
        if (rcmail.env.current_workspace_services.mail)
            top.rcmail.mel_metapage_fn.mail_wsp_updated();

    } catch (error) {
        
    }

    if (hasAriane)
    {
        //console.log("c");
        let channel = $(".wsp-ariane")[0].id.replace("ariane-", "");
        // //console.log("Init()", datas, channel, datas[channel]);
        // UpdateAriane(channel, false, (datas[channel] === undefined ? 0 : datas[channel]));

        // rcmail.addEventListener(`storage.change.${mel_metapage.Storage.ariane}`, (items) => {
        //     UpdateAriane(channel, false, window.new_ariane(items).getChannel(channel));
        // });
        (async () => {
            const manager = await ChatHelper.Manager();
            const managerCallback = await ChatHelper.ManagerCallback();
            UpdateAriane(channel, false, manager.chat().unreads?.[channel] ?? 0);
            manager.on_mentions_update.add(`WSP-CHAT-${channel}`, managerCallback.create((helper, key, value, unread) => {
                if (key === channel) {
                    UpdateAriane(channel, false, value ?? 0);
                }
            }));
        })()
    }

    UpdateCalendar();
    top.rcmail.addEventListener(mel_metapage.EventListeners.calendar_updated.after, UpdateCalendar);

    UpdateTasks();
    top.rcmail.addEventListener(mel_metapage.EventListeners.tasks_updated.after, UpdateTasks);

    if (rcmail.env.current_workspace_file === undefined &amp;&amp; rcmail.env.current_workspace_page !== undefined &amp;&amp; rcmail.env.current_workspace_page !== null)
    {
        if (rcmail.env.current_workspace_page !== "home")
        {
            const val = wsp_contract(rcmail.env.current_workspace_page);
            if (val === "ariane")
                setTimeout(async () => {
                    await wait(() => top.rcmail.busy);
                    $(`.wsp-ariane`).click();
                }, 100);
            else
                click_on_menu(rcmail.env.current_workspace_page);
                //ChangeToolbar(rcmail.env.current_workspace_page, $(`.wsp-${val}`));
            delete rcmail.env.current_workspace_page;
        }
        else if (rcmail.env.current_workspace_page)
            delete rcmail.env.current_workspace_page;

    }
    else if (rcmail.env.current_workspace_page)
        delete rcmail.env.current_workspace_page;


    wsp_mail_updated();
    setup_params();

    if ($("#createthings").length > 0)
        $("#createthings").removeClass("active");

    rcmail.triggerEvent("mel_workspace.middle", {
        uid,
        hasAriane, 
        datas
    });
}

/**
 * Appelé par WSPReady, actions que l'on fait en dernier, ce sont des actions plutôt lourdes ou asynchônes
 * @param {string} uid Id de l'espace de travail
 * @param {boolean} hasAriane Si l'espace possède une discussion ou non.
 * @param {*} datas Diverses données
 */
async function End(uid, hasAriane, datas) {

    let promises = [
        InitLinks()
    ];

    if (rcmail.env.current_workspace_services.wekan &amp;&amp; !wekan.isLogged())
        promises.push(wekan.login());

    // if (hasAriane)
    // {
    //     promises.push(wait(() => {
    //             return window.ariane === undefined
    //         })
    //         .then(() => {window.ariane.addEventListener("update", UpdateAriane);})
    //     );
    // }

    if (rcmail.env.current_workspace_file !== undefined &amp;&amp; rcmail.env.current_workspace_services.doc)
    {
        let it = 0;
        if (top.$(".stockage-frame").length == 0)
            promises.push(wait(() => rcmail.busy).then(() => mel_metapage.Functions.change_frame("stockage", false, true).then(() => {
                rcmail.set_busy(false);
                rcmail.clear_messages();

                if (rcmail.env.current_workspace_file !== undefined)
                {
                    return wait(() => {
                        if (++it >= 5)
                            return false;
                        
                        return rcmail.env.wsp_roundrive_show === undefined;
                    }).then(() =>{
                         setTimeout(() => {
                            rcmail.env.current_workspace_file.dirname = rcmail.env.current_workspace_file.path;
                            return rcmail.env.wsp_roundrive_show.clickFile(null, rcmail.env.current_workspace_file);
                        }, 500)
                    }
                         );
                }
            })));
    }

    await wait(() => rcmail.busy);

    return Promise.all(promises);

}

function wsp_contract(_class)
{
    switch (_class) {
        case "calendar":
            return "agenda"
        case "tasklist":
            return "tasks";
        case "params":
            return "item-params";
        case "rocket":
            return "ariane";
        case "doc":
            return "documents";
    
        default:
            return _class;
    }
}

var UpdateAriane = (channel, store, unread) => {
    let querry = $("#ariane-" + channel);

    $(".ariane-count").html(unread > 99 ? "+99" : unread).css("display", (unread === 0 ? "none" : ""));

    if (querry.length === 0)
        return;
    else {
        if (querry.find(".ariane-notif").length === 0)
            querry.append(`&lt;span `+(unread &lt;= 0 ? "style=display:none" : "")+` class="ariane-notif notif roundbadge lightgreen">`+unread+`&lt;/span>`);
        else {
            querry = querry.find(".ariane-notif");
            if (unread &lt;= 0)
                querry.css("display", "none");
            else {
                querry.html(unread).css("display", "");
            }
        }
    }
}

function click_on_menu(page)
{
    setTimeout(async () => {
        await wait(() => top.rcmail.busy);
        $(`.wsp-${wsp_contract(page)}`).click();
    }, 100);
}

/**
 * Met à jours les différents données de la toolbar
 * @param {string} key 
 * @param {function} func 
 * @param {function} funcBefore 
 * @param {function} funcAfter 
 */
function Update(key, func, funcBefore = null, funcAfter = null, ...args)
{
    if (funcBefore != null)
        funcBefore(...args);

    let data = mel_metapage.Storage.get(key);

    if (func != null)
        func(data, ...args);

    if (funcAfter != null)
        funcAfter(data, ...args);
}

function UpdateSomething(data,_class, editor = null)
{;
    if (editor !== null)
        data = editor(data);

    let querry = $("." + _class);
    const unread = data === null ? 0 : data;

    if (querry.find(".roundbadge").length === 0)
        querry.append(`&lt;span `+(unread &lt;= 0 ? "style=display:none" : "")+` class="notif roundbadge lightgreen">`+unread+`&lt;/span>`);
    else
    {
        querry = querry.find(".roundbadge");

        if (unread === 0)
            querry.css("display", "none");
        else
            querry.html(unread).css("display", "");
    }
}

async function UpdateCalendar()
{
    const uid = rcmail.env.current_workspace_uid;
    const before = "ws#";
    const id = before + uid;
    const Loader = (await loadJsModule('mel_metapage', 'calendar_loader', '/js/lib/calendar/')).CalendarLoader.Instance;
    let array = Loader.get_next_events_day(moment(), {})
                  .where(x => x.categories !== undefined &amp;&amp; x.categories.length > 0 &amp;&amp; x.categories.includes(id))
                  .where(x => x.free_busy !== "free" &amp;&amp; x.free_busy !== "telework")
                  .toArray();

    {
        const agenda = rcmail.env.current_workspace_constantes.agenda;
        const id = "wsp-block-" + agenda;
        let querry = $("#" + id).find(".block-body");
        if (array.length === 0) await setup_calendar(array, querry);//querry.html("Pas de réunion aujourd'hui !");
        else
        {
            const count = array.length;
            await setup_calendar(array, querry);
            UpdateSomething(count, "wsp-agenda-icon");
            $(".wsp-agenda-icon").find(".roundbadge").addClass("edited");
        }
    }
}

/**
 * Affiche les évènements.
 * @param {array} datas Données des évènements.
 */
async function setup_calendar(datas, querry, _date = moment())
{
    let html = await html_helper.Calendars({
        datas:datas,
        _date:_date,
        get_only_body:true,
        config:{
            add_day_navigation:false,
            add_create:false,
            create_function:null,
            add_see_all:false,
        next_when_empty_today_function: (storage) => {
            const id = `ws#${rcmail.env.current_workspace_uid}`;
            storage = Enumerable.from(storage).selectMany(x => Enumerable.from(x.value).select(s => s).toArray()).where(x => x.categories !== undefined &amp;&amp; x.categories.length > 0 &amp;&amp; x.categories[0].includes(id) ).groupBy(x => moment(x.start).format('DD/MM/YYYY'), x => x).toJsonDictionnary(x => x.key(), x => x.getSource());
            //console.log("setup_calendar", id, storage);
            return storage;
        }}
    });
	querry.html(html);

    if (!!html_helper.Calendars.$jquery_array)
    {
        const $jquery_array = html_helper.Calendars.$jquery_array;
        html_helper.Calendars.$jquery_array = undefined;
        querry.find('ul').html($jquery_array);
    }
}

function UpdateTasks()
{
    const uid = rcmail.env.current_workspace_tasklist_uid;
    let datas;
    Update(mel_metapage.Storage.other_tasks, UpdateSomething, null, null, "wsp-tasks", (data) => {
        if (data === null || data === undefined)
        {
            top.postMessage({
                message:"update_tasks"
            });
            return null;
        }
        datas = data[uid];
        if (data[uid] === undefined)
            return 0;
        else
            return data[uid].length;
    });
    SetupTasks(datas, "waiting-task");

}

function SetupTasks(datas, id, where = null)
{
    if (datas === undefined)
        datas = [];

    if (datas.length > 0 &amp;&amp; where !== null)
        datas = Enumerable.from(datas).where(where).toArray();

    let date;
    let querry = $("#" + id);
	let html = ''

	datas = Enumerable.from(datas).orderBy((x) => x.order).thenBy((x) => (x._hasdate === 1 ? x.datetime : Number.MAX_VALUE )).toArray();
    
    if (datas.length > 0)
    {
        html += `&lt;ul class="ignore-bullet">`;

        for (let index = 0; index &lt; datas.length; index++) {
            const element = datas[index];
            date = moment(parseInt(element.created + "000"));
            html += "&lt;li>";
            html += "&lt;div class=row style=margin-bottom:15px;margin-right:15px;>";

            if (date._isValid)
                html += `&lt;div class=col-md-10>&lt;a href=# class="element-block mel-not-link mel-focus" onclick="open_task('${element.id}', {source:'${rcmail.env.current_workspace_tasklist_uid}'})">&lt;span class="element-title default-text bold element-block">${element.title} ${(element.created === undefined ? "" : '&lt;/span>&lt;span class="element-desc element-block">Créée le ' + date.format("DD/MM/YYYY") + " à " + date.format("HH:mm") )}&lt;/span>&lt;/a>&lt;/div>`;
            else
                html += "&lt;div class=col-md-10>&lt;/div>";

            html += '&lt;div class=col-md-2>&lt;a style=display:none; onclick="add_task_to_completed(`'+element.id+'`)" class="roundbadge large hover tick ' + (element.mel_metapage.order == 0 ? "icofont-warning warning" : "icofont-hour-glass clear") + '">&lt;/a>&lt;/div>'
            html += "&lt;/div>";
            html += "&lt;/li>";
        }

        html += "&lt;/ul>";
    }
    // else {
    //     //html += "&lt;span>Aucune tâche en cours.&lt;/span>"
    // }


	querry.html(html);
    $("#nb-" + id).find(".nb").html(datas.length);

}

function GetDate(momentObject)
{
    return GetDateFr(momentObject.format("dddd DD MMMM"));
}

function GetDateFr(date)
{
    const capitalize = (s) => {
        if (typeof s !== 'string') return ''
        s = s.toLowerCase();
        return s.charAt(0).toUpperCase() + s.slice(1)
      }
    const arrayTransform = {
        "MONDAY":"LUNDI",
        "TUESDAY":"MARDI",
        "WEDNESDAY":"MERCREDI",
        "THURSDAY":"JEUDI",
        "FRIDAY":"VENDREDI",
        "SATURDAY":"SAMEDI",
        "SUNDAY":"DIMANCHE",
        "JANUARY":"JANVIER",
        "FEBRUARY":"FÉVRIER",
        "MARCH":"MARS",
        "APRIL":"AVRIL",
        "MAY":"MAI",
        "JUNE":"JUIN",
        "JULY":"JUILLET",
        "AUGUST":"AOÛT",
        "SEPTEMBER":"SEPTEMBRE",
        "OCTOBER":"OCTOBRE",
        "NOVEMBER":"NOVEMBRE",
        "DECEMBER":"DECEMBRE"
    }
    date = date.toUpperCase();

    for (const key in arrayTransform) {
        if (Object.hasOwnProperty.call(arrayTransform, key)) {
            const element = arrayTransform[key];
            if (date.includes(key))
                date = date.replace(key, element);
        }
    }

    return capitalize(date);
}

function create_calendar(id, e)
{
    let event = {
        categories:["ws#" + id],
        calendar_blocked:true,
        start:moment(),
        end:moment().add(1, "h")
    }
    rcmail.local_storage_set_item("tmp_calendar_event", event);

    return rcmail.commands['add-event-from-shortcut'] ? rcmail.command('add-event-from-shortcut', '', e.target, e) : rcmail.command('addevent', '', e.target, e);
}

function create_tasks(id, e)
{
    m_mp_set_storage('task_create');
    m_mp_set_storage('task_id', id);

    return mel_metapage.Functions.change_frame("tasklist", true, false, rcmail.env.current_workspace_tasklist_uid !== undefined &amp;&amp; rcmail.env.current_workspace_tasklist_uid !== null ? {source:rcmail.env.current_workspace_tasklist_uid} : null);
}

function SetCalendarDate(date = null)
{
    const now = date === null ? moment() : date;
    $(".swp-agenda-date").html(GetDate(now)).data("current-date", now);
}

function GetAgenda()
{
    const agenda = rcmail.env.current_workspace_constantes.agenda;
    const id = "wsp-block-" + agenda;

    return  $("#" + id).find(".block-body");
}

function GetTasks()
{
    const tasks = rcmail.env.current_workspace_constantes.tasks;
    const id = "wsp-block-" + tasks;

    return  $("#" + id).find(".block-body");
}

async function change_date(add)
{
    const check = (x, item) => {x.uid === item.uid};
    const before = "ws#";
    const uid = rcmail.env.current_workspace_uid;
    const id = before + uid;
    const date = moment($(".swp-agenda-date").data("current-date")).add(add, "d").startOf("day");
    SetCalendarDate(date);
    let querry = GetAgenda().html('&lt;center>&lt;span class="spinner-border">&lt;/span>&lt;/center>');
    const storage = mel_metapage.Storage.get(mel_metapage.Storage.calendar_by_days);
    const datas = (storage !== null &amp;&amp; storage[date.format('DD/MM/YYYY')] !== undefined ? storage[date.format('DD/MM/YYYY')] : await mel_metapage.Functions.update_calendar(date, moment(date).endOf("day")) );
    const events = Enumerable.from((typeof datas === "string" ? JSON.parse(datas) : datas)).where(x => x.categories !== undefined &amp;&amp; x.categories.length > 0 &amp;&amp; x.categories.includes(id)).toArray();

    if (events === null || events.length === 0)
    { 
        if (date === moment().startOf("day"))
            querry.html("Pas de réunion aujourd'hui !");
        else
            querry.html("Pas de réunion à cette date !");
    }
    else
    {
        let element;
        let tmp;
        let array = [];
        let elementsToDelete = [];

        for (let index = 0; index &lt; events.length; index++) {
            element = events[index];

            if (element.allDay)
                element.order = 0;
            else
                element.order = 1;

            tmp = mel_metapage.Functions.check_if_calendar_valid(element, events);
            
            if (tmp === true)
            {
                tmp = mel_metapage.Functions.check_if_date_is_okay(element.start, element.end, date);

                if (tmp === true)
                    array = Array.AddIfExist(array,check, element);
                else
                    elementsToDelete.push(element);
            }
            else if (tmp !== false)
                elementsToDelete.push(tmp);
        }

        array = Enumerable.from(array).where(x => !elementsToDelete.includes(x)).orderBy(x => x.order).thenBy(x => moment(x.start)).toArray();
        
        if (array.length === 0)
        {
            if (date === moment().startOf("day"))
                querry.html("Pas de réunion aujourd'hui !");
            else
                querry.html("Pas de réunion à cette date !");
        }
        else
            setup_calendar(array, querry, date);
    }
}

function OpenAriane(id, src)
{
    $(".wsp-object").css("display", "none");
    $(".wsp-toolbar-item").removeClass("active");
    $(".wsp-ariane").addClass("active");
    let querry = $("#" + id);

    if (querry.length === 0)
    {
        const frame = "&lt;iframe class=wsp-object id="+id+" src="+src+">&lt;/iframe>";
        $("#layout-content").find(".body").append(frame);
        querry = $("#" + id);
        querry.css("width", "100%")
        .css("height", "500px")
        .css("margin-top", "30px");
    }

    querry.css("display", "");
}



function UpdateFrameAriane()
{
    const down = "icon-mel-chevron-down";
    const right = "icon-mel-chevron-right";

    let arrow = $(".wsp-ariane-header").find(".arrow");

    if (arrow.hasClass(right))
    {
        arrow.removeClass(right).addClass(down).parent().attr("title", rcmail.gettext("close_ariane", "mel_workspace"));
        $(".ariane-frame").attr("aria-expanded", "true").find("iframe").css("display", "").parent().css("display", "");
        setTimeout(() => {
            rcmail.triggerEvent("init_rocket_chat", "wsp-disc-id");
        }, 100);
    }
    else
    {
        arrow.removeClass(down).addClass(right).parent().attr("title", rcmail.gettext("open_ariane", "mel_workspace"));
        $(".ariane-frame").attr("aria-expanded", "false").find("iframe").css("display", "none").parent().css("display", "none");;
    }
}

async function initCloud(tentative = 0, waiting_timeout = undefined)
{
    // debugger;
    // console.trace('tentative', tentative);
    if (rcmail.env.current_workspace_services.doc !== true || rcmail.env.is_stockage_active !== true)
        return;

    if(rcmail.env.checknews_action_on_error === undefined)
        rcmail.env.checknews_action_on_error = [];

    if(rcmail.env.checknews_action_on_success === undefined)
        rcmail.env.checknews_action_on_success = [];
        
    rcmail.env.checknews_action_on_error.push(() => {
        window.nc_state = false;
        //rcmail.display_message("Si vous venez de créer un espace de travail, attendez quelques minutes que l'espace se créé.", "error");
        //console.log("ncupdated", rcmail.env.current_nextcloud_updated);
        if (rcmail.env.current_nextcloud_updated === null || rcmail.env.current_nextcloud_updated === false)
        {
            rcmail.env.current_nextcloud_updated = moment();
            mel_metapage.Functions.post(mel_metapage.Functions.url("workspace", "get_date_stockage_user_updated"), {
                _uid:rcmail.env.current_workspace_uid,
                _date:moment().format(),
                _user:true
            });
        }
        else if (rcmail.env.current_nextcloud_updated === 0)
        {
            rcmail.env.current_nextcloud_updated = moment();
            mel_metapage.Functions.post(mel_metapage.Functions.url("workspace", "get_date_stockage_user_updated"), {
                _uid:rcmail.env.current_workspace_uid,
                _date:moment().format()
            }); 
        }

        const finished = moment(rcmail.env.current_nextcloud_updated).add(rcmail.env.wsp_waiting_nextcloud_minutes, "m");

        if (moment() &lt; finished) //(personnal data)
        {
            $("button.wsp-documents").css("display", "none");
            $("#cloud-frame").html(`
            &lt;center>&lt;div class="spinner-grow">&lt;/div>&lt;div>Création en cours...&lt;/div>&lt;/center>
            &lt;!--&lt;div class="progress">
                &lt;div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Création en cours...&lt;/div>
            &lt;/div>-->
            `);

            if (!waiting_timeout) {
                rcmail.display_message("Le module Documents de l'espace sera accessible dans quelques minutes.");
                rcmail.display_message("Une tentative de connexion automatique est en cours...");

                let val = 0;
                let createdTimeOut = setInterval(() => {
                    ///onst val = Math.round((1 - ((finished - moment())/(rcmail.env.wsp_waiting_nextcloud_minutes*60*1000)))*100);
                    //$("#cloud-frame .progress-bar").css("width", `${val}%`);
                    rcmail.triggerEvent("workspace.roundrive.createStockage.wait", val);
    
                    if (++val >= 20)
                    {
                        clearTimeout(createdTimeOut);
                    }
                    else{
                        console.info(`Creation tentative N°${val}...`);
                        rcmail.env.checknews_action_on_error = undefined;
                        rcmail.env.checknews_action_on_success = undefined;
                        initCloud(0, createdTimeOut);
                    }
    
    
                }, 30000);
            }
        }  
        else {

            if (!!waiting_timeout) {
                clearTimeout(waiting_timeout);
                waiting_timeout = null;
                console.info('Creation tentative stopped');
            }

            if (tentative === 0)
            {
                $("button.wsp-documents").css("display", "none");
                rcmail.display_message("Stockage non accessible pour le moment !", "error");
                setTimeout(() => {
                    rcmail.display_message("Si vous venez de rejoindre l'espace de travail, il sera accessible dans quelques minute !", "error");
                    setTimeout(() => {
                        rcmail.display_message("Tentative de connexion en cours...");
                        
                    }, 300);
                }, 200);
                console.info(`Tentative de connexion au stockage N°${tentative + 1}...`);
                rcmail.env.checknews_action_on_error = undefined;
                rcmail.env.checknews_action_on_success = undefined;
                return initCloud(1);
            }
            else if (tentative > 20) {
                rcmail.display_message("Impossible d'atteinde le stockage !", "error");
                rcmail.env.con_nex_impo = true;
                return;
            }

            setTimeout(() => {
                console.info(`Tentative de connexion au stockage N°${tentative + 1}...`);
                rcmail.env.checknews_action_on_error = undefined;
                rcmail.env.checknews_action_on_success = undefined;
                initCloud(++tentative);
            }, 30*1000);

        }

    });

    rcmail.env.checknews_action_on_success.push(() => {
        window.nc_state = true;
        if (rcmail.env.current_nextcloud_updated !== 1)
        {
            mel_metapage.Functions.post(mel_metapage.Functions.url("workspace", "get_date_stockage_user_updated"), {
                _uid:rcmail.env.current_workspace_uid,
                _set:true
            });
        }
    });

    const folder = `/dossiers-${rcmail.env.current_workspace_uid}`;

    let spinner = $("#spinner-grow-center");
    let frame = $("#cloud-frame");

    rcmail.env.wsp_roundrive_show = new RoundriveShow(folder, frame, {
        afterInit() {
            if (window.nc_state)
            {
                spinner.remove();
                frame.find('.con').remove();
                frame.parent().find('.progress').remove();

                if ($("button.wsp-documents").css("display") === "none") $("button.wsp-documents").css("display", '');

                clearInterval(window.nc_interval);

                if (!!waiting_timeout || tentative > 0)
                {
                    if (!!waiting_timeout) {
                        clearTimeout(waiting_timeout);
                        waiting_timeout = null;
                        console.info('Creation tentative stopped');
                    }

                    rcmail.display_message("Connexion au stockage réussie !", "confirmation");
                }
            }
            else if (rcmail.env.con_nex_impo === true) {
                spinner.remove();
                frame.html($('&lt;p>').text('Impossible de se connecter aux documents !').css('width', '100%').css('text-align', 'center'));

                if (!!waiting_timeout) {
                    clearTimeout(waiting_timeout);
                    waiting_timeout = null;
                    console.info('Creation tentative stopped');
                }
            }
            else {
                frame.html($('&lt;p>').addClass('con').text('Tentative de connexion aux documents...').css('width', '100%').css('text-align', 'center'));
                if (frame.parent().find('.progress').length === 0){
                    let $progress = $(`&lt;div class="progress">
                            &lt;div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%&lt;/div>
                       &lt;/div>`);
                    $progress = $progress.appendTo(frame.parent()).find('.progress-bar').css('color', 'transparent');

                    window.nc_interval = startTimer(600, $progress);
                }
            }

            frame.css("display", "");
        },

        async updatedFunc(bool) {

            if (bool &amp;&amp; $(".wsp-documents").find(".notif").length === 0)
                $(".wsp-documents").append(`&lt;span style="" class="notif roundbadge lightgreen">•&lt;/span>`);
            else if (!bool &amp;&amp; $(".wsp-documents").find(".notif").length > 0)
                $(".wsp-documents").find(".notif").remove();

            const id = `wsp_have_news_${rcmail.env.username}`;
            let datas = mel_metapage.Storage.get(id);

            if (datas === undefined || datas === null)
                datas = {};

            datas[rcmail.env.current_workspace_uid] = bool;
            
            mel_metapage.Storage.set(id, datas);

            mel_metapage.Functions.call(`trigger.${mel_metapage.EventListeners.wsp_stockage_updated.after}`, true, {
                always:true,
                _integrated:true
            });
        },
        classes:{
            folder:"wsp-rd-row",
            file:"wsp-rd-row last"
        },
        wsp:rcmail.env.current_workspace_uid,
        show_errors:false
    });
}

function startTimer(duration, bar) {
    var timer = duration, minutes, seconds;
    const interval = setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);
        
        var totalSeconds = duration
        , remainingSeconds = minutes * 60 + seconds
        , width = (100-(remainingSeconds*100/totalSeconds)) 
        
        bar.css('width', width + '%');
        bar.attr('aria-valuenow', width).text(width + '%');

        if (!bar.hasClass('bg-warning') &amp;&amp; width > 50) {
            bar.addClass('bg-warning');
        }
        else if (!bar.hasClass('bg-danger') &amp;&amp; width > 80) {
            bar.removeClass('bg-warning');
            bar.addClass('bg-danger');
        }

        if (--timer &lt; 0) {
            clearInterval(interval);
        }
    }, 1000);

    return interval;
}

function showMail($id)
{
    try {
        event.preventDefault();
    } catch (error) {
        
    }
    //?_task=mail&amp;_action=show&amp;_uid=363&amp;_mbox=INBOX

    let config = {
        _uid:$id
    };

    if (top.$("iframe.mail-frame").length > 0)
    {
        config[rcmail.env.mel_metapage_const.key] = rcmail.env.mel_metapage_const.key.value;
        workspaces.sync.PostToParent({
            exec:"select_mail",
            _integrated:true,
            child:false,
            args:[$id, true]
        });
        mel_metapage.Functions.change_frame("mail");
    }
    else if (top.$(".mail-frame").length > 0)
    {
        rcmail.set_busy(true, "loading");
        top.location.href = mel_metapage.Functions.url("mail", "show", config).replaceAll(`&amp;${rcmail.env.mel_metapage_const.key}=${rcmail.env.mel_metapage_const.value}`, "");
    }
    else {
        config["_action"] = "show";
        mel_metapage.Functions.change_frame("mail", true, false, config);
    }
}

function wsp_mail_updated()
{

    const tmpDatas = mel_metapage.Storage.get(mel_metapage.Storage.wsp_mail);

    let datas = [];

    for (const key in tmpDatas) {
        if (Object.hasOwnProperty.call(tmpDatas, key)) {
            const element = tmpDatas[key];
            datas[key.split("@")[0].replace("edt.", "")] = element;
        }
    }

    let html = "";

    //const bool1 = datas === undefined || datas === null || datas[rcmail.env.current_workspace_uid] === undefined || datas[rcmail.env.current_workspace_uid] === null;

    if (datas === undefined || datas === null || datas[rcmail.env.current_workspace_uid] === undefined || datas[rcmail.env.current_workspace_uid] === null)
    {    
        html = "Aucun mail non lu.";
        $(".wsp-mail").find(".notif").remove();
    }
    else {
        for (const key in datas[rcmail.env.current_workspace_uid]) {
            if (Object.hasOwnProperty.call(datas[rcmail.env.current_workspace_uid], key)) {
                const element = datas[rcmail.env.current_workspace_uid][key];
                html += `&lt;a href="#" class="row wsp-email-row mel-not-link mel-focus" onclick="showMail('${element.uid}')">`;
                html += `&lt;div class="col-md-3 wsp-email-from">&lt;p class="sr-only">De : &lt;/p>${element.from}&lt;/div>`;
                html += `&lt;div class="col-md-6 wsp-email-subject">&lt;p class="sr-only"> Objet : &lt;/p>${element.subject}&lt;/div>`;
                html += `&lt;div class="col-md-3 wsp-email-date">&lt;p class="sr-only"> Reçu le : &lt;/p>${element.date}&lt;/div>`;
                html += "&lt;/a>";
            }
        }

        $(".wsp-mail").append(`&lt;span style="" class="notif roundbadge lightgreen">${datas[rcmail.env.current_workspace_uid].length}&lt;/span>`)

    }

    $(".unreads-emails").html(html);
}

async function InitLinks()
{
    if (rcmail.env.current_workspace_services["useful-links"]) //Si le service est activé
    {

        rcmail.addEventListener("mel_metapage_refresh", () => {
            refreshUsefulLinks();
        });

        if (!rcmail.env.current_workspace_services.doc || !rcmail.env.is_stockage_active) //Si nextcloud n'est pas activé
        {
            $("#ressources-links").parent().parent().find(".wsp-block.wsp-left.wsp-resources").css("background-color", "transparent")
        }

        $(".tab-ressources.mel-tab.mel-tabheader").each((i, e) => {
            if (e.id === "ressources-links" || e.id === 'ressources-surveys')
            {
                $(e).click(() => {
                    $(e).parent().parent().find(".wsp-block.wsp-left.wsp-resources").css("background-color", "transparent")
                });
            }
            else
            {
                $(e).click(() => {
                    $(e).parent().parent().find(".wsp-block.wsp-left.wsp-resources").css("background-color", "")
                });
            }
        });

        $("#button-create-new-ulink").click(() =>{
            GetLinkPopUp().setLinkEditor(new MelLink(), "workspace", "update_ulink", {_workspace_id:rcmail.env.current_workspace_uid}, async (result) => {
                
                if (result)
                { 
                    await mel_metapage.Functions.callAsync(`$(".links-frame").remove()`, false);
                    $(".wsp-toolbar-item.wsp-links").click();
                }

                GetLinkPopUp().hide();
            }).show();
        });
        
    }
}

function PaperClipCopy(link)
{
    function copyOnClick (val) {
        var tempInput = document.createElement ("input"); 
        tempInput.value = val;
         document.body.appendChild (tempInput); 
         tempInput.select (); 
         document.execCommand ("copy"); 
         document.body.removeChild (tempInput); 
    }
    const url = link[0].href;
    copyOnClick(url);
    rcmail.display_message(`${url} copié dans le presse-papier.`, "confirmation")
}

function refreshUsefulLinks()
{
    if (rcmail.env.current_workspace_services["useful-links"]) 
    {
        mel_metapage.Functions.post(mel_metapage.Functions.url("workspace", "refresh_html_ulinks"), {
            _workspace_id:rcmail.env.current_workspace_uid
        }, (datas) => {
            $(".wsp-block.wsp-left.wsp-resources .ressources-links").html(datas);
        });
        //$(".ressources-links")
    }
}

function setup_params()
{
    const tmp = (img) =>
    {
        img = img.split(".");
        
        if (img.length > 1)
            img[img.length-1] = "";

        img = img.join(".");
        img = img.slice(0, img.length-1);

        return img;
    };

    let html = "";

    if (rcmail.env.mel_metapage_workspace_logos.length > 0)
    {
        html += `&lt;li role=menuitem>&lt;a title="" aria-disabled=true href=# tabindex=-1 class="active" id="" href="#" onclick="m_wp_change_picture(null)">&lt;img src="`+rcmail.env.mel_metapage_workspace_logos[0].path+`" class="menu-image invisible">Aucune image&lt;/a>&lt;/li>`;
        
        for (let index = 0; index &lt; rcmail.env.mel_metapage_workspace_logos.length; index++) {
            const element = rcmail.env.mel_metapage_workspace_logos[index];
            html += `&lt;li role=menuitem>&lt;a aria-disabled=true href=# alt="${Enumerable.from(element.path.replace(".png", "").replace(".jpg", "").replace(".PNG", "").split("/")).last()}" title="" class="active" id="" tabindex=-1 href="#" onclick="m_wp_change_picture('`+element.path+`')">&lt;img src="`+element.path+`" class=menu-image>`+tmp(element.name)+`&lt;/a>&lt;/li>`;
        }
    }
    $("#ul-wsp-params").html(html);
}

function m_wp_change_picture(img)
{
    if (img === null)
    {
        $("#spaceLogo").html(`&lt;span>${$(".wsp-head h1.header-wsp").html().slice(0,3)}&lt;/span>`);
    }
    else
        $("#spaceLogo").html(`&lt;img alt="${Enumerable.from(img.replace(".png", "").replace(".PNG", "").split("/")).last()}" src="${img}" />&lt;p class="sr-only"> - Changer d'avatar&lt;/p>`);

    $("#wsp-param-chg-button-plz").removeAttr("disabled").removeClass("disabled");
}

function setup_end_date()
{
    let querry = $("#new-end-date");

    if (querry.length > 0)
    {
        querry.datetimepicker({
            format: 'd/m/Y H:i',
            lang:"fr",
            step:15
        });
    }

    const date = rcmail.env.current_settings.end_date;
    if (date !== undefined &amp;&amp; date !== null &amp;&amp; date !== "")
    {
        let querry = $("#wsp-end-date");
        if (moment() >= moment(date, "DD/MM/YYYY hh:mm"))
            querry.html("&lt;i>Espace clôt !&lt;/i>")
        else
            querry.html(`Date de fin : ${date}`);
    }
}

function survey_edit(e)
{
    e = $(e);
    rcmail.command('workspace.survey.edit', {
        id:e.data('sid'),
        title:e.data('stitle'),
        link:e.data('slink')
    });
}

function survey_delete(e)
{
    rcmail.command('workspace.survey.delete', $(e).data('sid'));
}

function survey_copy(e)
{
    mel_metapage.Functions.copy($(e).data('slink'))
}

function connect_sondage()
{
    //if (!!top.rcmail.env.sondage_loaded) return $.ajax();

    return $.ajax({ // fonction permettant de faire de l'ajax
        type: "POST", // methode de transmission des données au fichier php
        url: rcmail.env.sondage_url+'/?_p=external_login', // url du fichier php
        data: "username="+rcmail.env.sondage_username+"&amp;password="+rcmail.env.sondage_password+"&amp;timezone="+rcmail.env.sondage_timezone, // données à transmettre
        xhrFields: {
            withCredentials: true
        },
        crossDomain: true,
        success: function (data) {
            let url;
            for (const iterator of $('iframe.wsp-sondage')) {
                url = $(iterator).data('src');
                iterator.src = url;
                if (navigator.appName == "Microsoft Internet Explorer"){
                    iterator.reload(true);
                }
            }

            $("#wait_box").hide();
            top.rcmail.env.sondage_loaded = true;
        },
        error: function (xhr, ajaxOptions, thrownError) { // Add these parameters to display the required response
            $("#wait_box").hide();
        },
    });
}

function inject_embeded(iframe)
{
    const $ = iframe.contentWindow.$;
    $('#head').css('display', 'none');
    $('.toolbar').css('display', 'none');
    $('#left-panel').css('display', 'none');
}

function init_sondages()
{
    for (const iterator of $('iframe.wsp-sondage')) {
        $(iterator).on('load', (e) => {
            inject_embeded(e.currentTarget);
        });
        inject_embeded(iterator);
    }
}

function setup_wsp_colors() {
   const color = rcmail.env.current_settings.color;

    if (!!color) {
        let $querry = $('.dwp-round.wsp-picture span');

        if ($querry.length > 0){
            let textColor =  $('.dwp-round.wsp-picture span').css('color').replaceAll('rgb', '').replaceAll('a', '').replaceAll('(', '').replaceAll(')', '').split(','); 
            if (!mel_metapage.Functions.colors.kMel_LuminanceRatioAAA(textColor, mel_metapage.Functions.colors.kMel_extractRGB(color))) {
                $querry.css('color', 'white');
            }
            else $querry.css('color', '#363A5B');

            textColor = null;
        }

        $querry = null;
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="OCA.Bnum.html">Bnum</a></li><li><a href="OCA.Bnum.App.html">App</a></li><li><a href="animation.html">animation</a></li><li><a href="aria.html">aria</a></li></ul><h3>Classes</h3><ul><li><a href="AMelScreenManager.html">AMelScreenManager</a></li><li><a href="Alarm.html">Alarm</a></li><li><a href="AlarmData.html">AlarmData</a></li><li><a href="AlarmPart.html">AlarmPart</a></li><li><a href="AudioVisualizer.html">AudioVisualizer</a></li><li><a href="BnumConnector.html">BnumConnector</a></li><li><a href="CalendarEvent.html">CalendarEvent</a></li><li><a href="CalendarLoader.html">CalendarLoader</a></li><li><a href="Calendar_Alarm.html">Calendar_Alarm</a></li><li><a href="CategoryData.html">CategoryData</a></li><li><a href="CategoryPart.html">CategoryPart</a></li><li><a href="ChatManager.html">ChatManager</a></li><li><a href="Color.html">Color</a></li><li><a href="ColorRGBA.html">ColorRGBA</a></li><li><a href="Connector.html">Connector</a></li><li><a href="EventField.html">EventField</a></li><li><a href="EventListenerDatas.html">EventListenerDatas</a></li><li><a href="EventManager.html">EventManager</a></li><li><a href="EventParts.html">EventParts</a></li><li><a href="EventView.html">EventView</a></li><li><a href="FreeBusyGuests.html">FreeBusyGuests</a></li><li><a href="GlobalModal.html">GlobalModal</a></li><li><a href="GlobalModalConfig.html">GlobalModalConfig</a></li><li><a href="GuestsPart_GuestsPart.html">GuestsPart</a></li><li><a href="IExt.html">IExt</a></li><li><a href="IntegratedVisio.html">IntegratedVisio</a></li><li><a href="InternalWebconfScreenManager.html">InternalWebconfScreenManager</a></li><li><a href="ListenerWebConfBar.html">ListenerWebConfBar</a></li><li><a href="MasterWebconfBar.html">MasterWebconfBar</a></li><li><a href="MasterWebconfBarItem.html">MasterWebconfBarItem</a></li><li><a href="MasterWebconfBarPopup.html">MasterWebconfBarPopup</a></li><li><a href="MelAudioManager.html">MelAudioManager</a></li><li><a href="MelAudioStruct.html">MelAudioStruct</a></li><li><a href="MelDataStore.html">MelDataStore</a></li><li><a href="MelIconPrevisualiser.html">MelIconPrevisualiser</a></li><li><a href="MelListingPrevisualiser.html">MelListingPrevisualiser</a></li><li><a href="MelNews.html">MelNews</a></li><li><a href="MelObject.html">MelObject</a></li><li><a href="MelPrevisualiser.html">MelPrevisualiser</a></li><li><a href="Mel_Promise.html">Mel_Promise</a></li><li><a href="MetapageModule.html">MetapageModule</a></li><li><a href="NewsPopup.html">NewsPopup</a></li><li><a href="Nextcloud_Document.html">Nextcloud_Document</a></li><li><a href="Nextcloud_Document_Config.html">Nextcloud_Document_Config</a></li><li><a href="Nextcloud_File.html">Nextcloud_File</a></li><li><a href="Nextcloud_Icon.html">Nextcloud_Icon</a></li><li><a href="Nextcloud_Response.html">Nextcloud_Response</a></li><li><a href="NotifierObject.html">NotifierObject</a></li><li><a href="OCA.Bnum.FileList.html">FileList</a></li><li><a href="ParapheurAction.html">ParapheurAction</a></li><li><a href="ParapheurMailAction.html">ParapheurMailAction</a></li><li><a href="RcmailDialog.html">RcmailDialog</a></li><li><a href="RcmailDialogButton.html">RcmailDialogButton</a></li><li><a href="RcmailDialogChoiceButton.html">RcmailDialogChoiceButton</a></li><li><a href="RightPannel.html">RightPannel</a></li><li><a href="RotomecaEnumerable.html">RotomecaEnumerable</a></li><li><a href="SearchResult.html">SearchResult</a></li><li><a href="SearchResultCalendar.html">SearchResultCalendar</a></li><li><a href="Slot.html">Slot</a></li><li><a href="Slots.html">Slots</a></li><li><a href="SplittedDate.html">SplittedDate</a></li><li><a href="Sticker.html">Sticker</a></li><li><a href="Title.html">Title</a></li><li><a href="VisioManager.html">VisioManager</a></li><li><a href="VisualiserObject.html">VisualiserObject</a></li><li><a href="VisualiserObjectEx_VisualiserObjectEx.html">VisualiserObjectEx</a></li><li><a href="WarningPanel.html">WarningPanel</a></li><li><a href="Webconf.html">Webconf</a></li><li><a href="WebconfChat.html">WebconfChat</a></li><li><a href="WebconfPageCreator.html">WebconfPageCreator</a></li><li><a href="WebconfScreenManager.html">WebconfScreenManager</a></li><li><a href="WebconfWorkspaceManager.html">WebconfWorkspaceManager</a></li><li><a href="aria.Dialog.html">Dialog</a></li><li><a href="html_events.html">html_events</a></li><li><a href="html_li.html">html_li</a></li><li><a href="html_ul.html">html_ul</a></li><li><a href="mail_html_mail_html.html">mail_html</a></li><li><a href="mel_cancellable_html_timer.html">mel_cancellable_html_timer</a></li><li><a href="mel_filter.html">mel_filter</a></li><li><a href="mel_html.html">mel_html</a></li><li><a href="mel_html2.html">mel_html2</a></li><li><a href="mel_html_timer.html">mel_html_timer</a></li><li><a href="rcube_splitter.html">rcube_splitter</a></li><li><a href="search.html">search</a></li><li><a href="searchBlock.html">searchBlock</a></li></ul><h3>Events</h3><ul><li><a href="AlarmPart.html#event:onChange">onChange</a></li><li><a href="CategoryPart.html#event:onChange">onChange</a></li><li><a href="EventView.html#event:before_save">before_save</a></li><li><a href="EventView.html#event:on_dialog_before_close">on_dialog_before_close</a></li><li><a href="EventView.html#event:on_drop">on_drop</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Cette">Cette</a></li><li><a href="global.html#DAY_MS">DAY_MS</a></li><li><a href="global.html#DeleteLink">DeleteLink</a></li><li><a href="global.html#End">End</a></li><li><a href="global.html#Enum%25C3%25A9ration">Enumération</a></li><li><a href="global.html#GetLinkPopUp">GetLinkPopUp</a></li><li><a href="global.html#HOUR_MS">HOUR_MS</a></li><li><a href="global.html#Middle">Middle</a></li><li><a href="global.html#Mode">Mode</a></li><li><a href="global.html#Nextcloud">Nextcloud</a></li><li><a href="global.html#Nombres">Nombres</a></li><li><a href="global.html#PDFFindBar">PDFFindBar</a></li><li><a href="global.html#PDFFindController">PDFFindController</a></li><li><a href="global.html#Plugin">Plugin</a></li><li><a href="global.html#Portail">Portail</a></li><li><a href="global.html#RoundriveCreate">RoundriveCreate</a></li><li><a href="global.html#SELECTOR_CLASS_ROUND_CALENDAR">SELECTOR_CLASS_ROUND_CALENDAR</a></li><li><a href="global.html#Start">Start</a></li><li><a href="global.html#TextLayerBuilder">TextLayerBuilder</a></li><li><a href="global.html#Tri">Tri</a></li><li><a href="global.html#URL">URL</a></li><li><a href="global.html#Update">Update</a></li><li><a href="global.html#ViewHistory">ViewHistory</a></li><li><a href="global.html#WSPReady">WSPReady</a></li><li><a href="global.html#_on_mention_update">_on_mention_update</a></li><li><a href="global.html#add_mobile_class">add_mobile_class</a></li><li><a href="global.html#api_notifications">api_notifications</a></li><li><a href="global.html#audio_alarms">audio_alarms</a></li><li><a href="global.html#audiourltotest">audiourltotest</a></li><li><a href="global.html#base_color">base_color</a></li><li><a href="global.html#base_text_color">base_text_color</a></li><li><a href="global.html#changeType">changeType</a></li><li><a href="global.html#checkAllIdentities">checkAllIdentities</a></li><li><a href="global.html#checkOneIdentity">checkOneIdentity</a></li><li><a href="global.html#check_workspace_integrity">check_workspace_integrity</a></li><li><a href="global.html#command_parapheur">command_parapheur</a></li><li><a href="global.html#componentToHex">componentToHex</a></li><li><a href="global.html#copy_signature">copy_signature</a></li><li><a href="global.html#createImage">createImage</a></li><li><a href="global.html#createLogo">createLogo</a></li><li><a href="global.html#createLogoType">createLogoType</a></li><li><a href="global.html#current_desktop_notification">current_desktop_notification</a></li><li><a href="global.html#date2ISO8601">date2ISO8601</a></li><li><a href="global.html#date2unixtime">date2unixtime</a></li><li><a href="global.html#default_note_uid">default_note_uid</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#dialog">dialog</a></li><li><a href="global.html#dismiss_alarm">dismiss_alarm</a></li><li><a href="global.html#display_alarms">display_alarms</a></li><li><a href="global.html#docReady">docReady</a></li><li><a href="global.html#download">download</a></li><li><a href="global.html#download_signature_outlook_htm">download_signature_outlook_htm</a></li><li><a href="global.html#download_signature_outlook_zip">download_signature_outlook_zip</a></li><li><a href="global.html#download_signature_thunderbird">download_signature_thunderbird</a></li><li><a href="global.html#enum_tooltip_mode">enum_tooltip_mode</a></li><li><a href="global.html#enum_tooltip_position">enum_tooltip_position</a></li><li><a href="global.html#ev_calendar_url">ev_calendar_url</a></li><li><a href="global.html#event_date_text">event_date_text</a></li><li><a href="global.html#fluxhtml">fluxhtml</a></li><li><a href="global.html#fluxrss">fluxrss</a></li><li><a href="global.html#folder_collapse">folder_collapse</a></li><li><a href="global.html#folder_collapse_unified">folder_collapse_unified</a></li><li><a href="global.html#folder_count">folder_count</a></li><li><a href="global.html#folder_count_unified">folder_count_unified</a></li><li><a href="global.html#folder_expand">folder_expand</a></li><li><a href="global.html#formatPhoneNumber">formatPhoneNumber</a></li><li><a href="global.html#format_datetime">format_datetime</a></li><li><a href="global.html#format_time">format_time</a></li><li><a href="global.html#fromunixtime">fromunixtime</a></li><li><a href="global.html#generate_canvas">generate_canvas</a></li><li><a href="global.html#getOutputScale">getOutputScale</a></li><li><a href="global.html#getPDFFileNameFromURL">getPDFFileNameFromURL</a></li><li><a href="global.html#getSignatureHTML">getSignatureHTML</a></li><li><a href="global.html#get_organizer">get_organizer</a></li><li><a href="global.html#has_attendees">has_attendees</a></li><li><a href="global.html#has_permission">has_permission</a></li><li><a href="global.html#hide_header_row">hide_header_row</a></li><li><a href="global.html#init_recurrence_edit">init_recurrence_edit</a></li><li><a href="global.html#init_time_autocomplete">init_time_autocomplete</a></li><li><a href="global.html#isArrayLike">isArrayLike</a></li><li><a href="global.html#isAsync">isAsync</a></li><li><a href="global.html#isNullOrUndefined">isNullOrUndefined</a></li><li><a href="global.html#is_attendee">is_attendee</a></li><li><a href="global.html#is_internal_organizer">is_internal_organizer</a></li><li><a href="global.html#is_organizer">is_organizer</a></li><li><a href="global.html#libkolab_audittrail">libkolab_audittrail</a></li><li><a href="global.html#load_next_page">load_next_page</a></li><li><a href="global.html#loader">loader</a></li><li><a href="global.html#m_mp_Create">m_mp_Create</a></li><li><a href="global.html#m_mp_CreateDocumentIconContract">m_mp_CreateDocumentIconContract</a></li><li><a href="global.html#m_mp_CreateEvent">m_mp_CreateEvent</a></li><li><a href="global.html#m_mp_CreateEvent_inpage">m_mp_CreateEvent_inpage</a></li><li><a href="global.html#m_mp_CreateOrOpenFrame">m_mp_CreateOrOpenFrame</a></li><li><a href="global.html#m_mp_Help">m_mp_Help</a></li><li><a href="global.html#m_mp_InitializeDocument">m_mp_InitializeDocument</a></li><li><a href="global.html#m_mp_NotificationFilter">m_mp_NotificationFilter</a></li><li><a href="global.html#m_mp_NotificationGetDate">m_mp_NotificationGetDate</a></li><li><a href="global.html#m_mp_NotificationGetElement">m_mp_NotificationGetElement</a></li><li><a href="global.html#m_mp_NotificationProcess">m_mp_NotificationProcess</a></li><li><a href="global.html#m_mp_NotificationProcessAfterAction">m_mp_NotificationProcessAfterAction</a></li><li><a href="global.html#m_mp_NotificationRefresh">m_mp_NotificationRefresh</a></li><li><a href="global.html#m_mp_NotificationRun">m_mp_NotificationRun</a></li><li><a href="global.html#m_mp_NotificationSettings">m_mp_NotificationSettings</a></li><li><a href="global.html#m_mp_NotificationStartup">m_mp_NotificationStartup</a></li><li><a href="global.html#m_mp_NotificationsAction">m_mp_NotificationsAction</a></li><li><a href="global.html#m_mp_NotificationsAppendFilters">m_mp_NotificationsAppendFilters</a></li><li><a href="global.html#m_mp_NotificationsAppendToPanel">m_mp_NotificationsAppendToPanel</a></li><li><a href="global.html#m_mp_NotificationsClean">m_mp_NotificationsClean</a></li><li><a href="global.html#m_mp_NotificationsDelete">m_mp_NotificationsDelete</a></li><li><a href="global.html#m_mp_NotificationsGet">m_mp_NotificationsGet</a></li><li><a href="global.html#m_mp_NotificationsMerge">m_mp_NotificationsMerge</a></li><li><a href="global.html#m_mp_NotificationsRefreshUnread">m_mp_NotificationsRefreshUnread</a></li><li><a href="global.html#m_mp_NotificationsSet">m_mp_NotificationsSet</a></li><li><a href="global.html#m_mp_NotificationsShowUnread">m_mp_NotificationsShowUnread</a></li><li><a href="global.html#m_mp_NotificationsSort">m_mp_NotificationsSort</a></li><li><a href="global.html#m_mp_OpenTask">m_mp_OpenTask</a></li><li><a href="global.html#m_mp_RizomoRefreshNotifications">m_mp_RizomoRefreshNotifications</a></li><li><a href="global.html#m_mp_ShowDesktopNotification">m_mp_ShowDesktopNotification</a></li><li><a href="global.html#m_mp_ShowNotification">m_mp_ShowNotification</a></li><li><a href="global.html#m_mp_ToggleGroupOptionsUser">m_mp_ToggleGroupOptionsUser</a></li><li><a href="global.html#m_mp_UpdateCreateDoc">m_mp_UpdateCreateDoc</a></li><li><a href="global.html#m_mp_action_from_storage">m_mp_action_from_storage</a></li><li><a href="global.html#m_mp_anchor_ariane">m_mp_anchor_ariane</a></li><li><a href="global.html#m_mp_close_ariane">m_mp_close_ariane</a></li><li><a href="global.html#m_mp_full_screen_ariane">m_mp_full_screen_ariane</a></li><li><a href="global.html#m_mp_get_all_hashtag">m_mp_get_all_hashtag</a></li><li><a href="global.html#m_mp_help_video">m_mp_help_video</a></li><li><a href="global.html#m_mp_set_storage">m_mp_set_storage</a></li><li><a href="global.html#mel_metapage">mel_metapage</a></li><li><a href="global.html#mel_shortcuts_press">mel_shortcuts_press</a></li><li><a href="global.html#meteo">meteo</a></li><li><a href="global.html#mm_s_Action">mm_s_Action</a></li><li><a href="global.html#mm_s_AfficheResults">mm_s_AfficheResults</a></li><li><a href="global.html#mm_s_CreateOrUpdateFrame">mm_s_CreateOrUpdateFrame</a></li><li><a href="global.html#mm_s_OnClick">mm_s_OnClick</a></li><li><a href="global.html#mm_s_bodyClick">mm_s_bodyClick</a></li><li><a href="global.html#mm_s_extend">mm_s_extend</a></li><li><a href="global.html#modify_signature">modify_signature</a></li><li><a href="global.html#noContextMenuHandler">noContextMenuHandler</a></li><li><a href="global.html#onInputChange">onInputChange</a></li><li><a href="global.html#open_dialog">open_dialog</a></li><li><a href="global.html#parseISO8601">parseISO8601</a></li><li><a href="global.html#parse_datetime">parse_datetime</a></li><li><a href="global.html#plugin_text">plugin_text</a></li><li><a href="global.html#rcm_tb_label_insert">rcm_tb_label_insert</a></li><li><a href="global.html#rcm_tb_label_submenu">rcm_tb_label_submenu</a></li><li><a href="global.html#rcube_libcalendaring">rcube_libcalendaring</a></li><li><a href="global.html#rcube_mail_ui">rcube_mail_ui</a></li><li><a href="global.html#rcube_scroller">rcube_scroller</a></li><li><a href="global.html#rcube_tasklist">rcube_tasklist</a></li><li><a href="global.html#rcube_tasklist_ui">rcube_tasklist_ui</a></li><li><a href="global.html#rgbToHex">rgbToHex</a></li><li><a href="global.html#save_option">save_option</a></li><li><a href="global.html#saving_lock">saving_lock</a></li><li><a href="global.html#scrollIntoView">scrollIntoView</a></li><li><a href="global.html#send_francetransfert_message">send_francetransfert_message</a></li><li><a href="global.html#send_melanissimo_message">send_melanissimo_message</a></li><li><a href="global.html#send_with_francetransfert">send_with_francetransfert</a></li><li><a href="global.html#send_with_melanissimo">send_with_melanissimo</a></li><li><a href="global.html#serialize_recurrence">serialize_recurrence</a></li><li><a href="global.html#set_recurrence_edit">set_recurrence_edit</a></li><li><a href="global.html#set_title">set_title</a></li><li><a href="global.html#set_toolbar_item_valid">set_toolbar_item_valid</a></li><li><a href="global.html#settings_da_set_email_recup">settings_da_set_email_recup</a></li><li><a href="global.html#setup_calendar">setup_calendar</a></li><li><a href="global.html#show_header_row">show_header_row</a></li><li><a href="global.html#show_password_change">show_password_change</a></li><li><a href="global.html#show_rcube_manage_labels">show_rcube_manage_labels</a></li><li><a href="global.html#snooze_dropdown">snooze_dropdown</a></li><li><a href="global.html#startX">startX</a></li><li><a href="global.html#stockage">stockage</a></li><li><a href="global.html#tasklist_options_menu">tasklist_options_menu</a></li><li><a href="global.html#text2html">text2html</a></li><li><a href="global.html#text_color">text_color</a></li><li><a href="global.html#toHex">toHex</a></li><li><a href="global.html#unlock_saving">unlock_saving</a></li><li><a href="global.html#use_signature">use_signature</a></li><li><a href="global.html#validate_message">validate_message</a></li><li><a href="global.html#visualValueCount">visualValueCount</a></li><li><a href="global.html#wait">wait</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Mar 06 2024 17:26:58 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
